---
title: "Kasser_Ryan_1993"
author: "Leopold Roth"
date: "2023-11-24"
output: 
  html_document:
    toc: true
    toc_depth: 4
---

# Packages
```{r}
# R version: 4.3.1
library(dplyr) # 1.1.2
library(readr) # 2.1.4
library(readxl) # 1.4.2
library(haven) # 2.5.2
library(misty) # 0.5.4
library(tidyr) # 1.3.0
library(ggplot2) # 3.4.4
library(sjPlot) # 2.8.14
library(broom) # 1.0.5
library(writexl)
library(forcats)
```

# Load Data
```{r}
#this chunk loads the dataset, strores it in the object 'df' and reassures that it is a dataframe
df <- read_sav("data/[PCIRR] Kasser and Ryan (1993) replication CR_1993 [Team Leo]_NOCHECKS_December 14, 2023_07.52.sav")
df <- as.data.frame(df)
#N initial:
```

# Check data
## exclude incomplete cases
```{r}
#this subsets the data to only keep cases who completed the entire survey
df<-subset(df, as.numeric(Progress) == 100)
#N complete:
```

## exclude by conduction time (3SD faster than average)
```{r}
#this serves the purpose to exclude cases in which people/bots clicked through everything as fast as possible
df$Duration__in_seconds_<-as.numeric(df$Duration__in_seconds_)
sd_duration<-(sd(df$Duration__in_seconds_)*3) #compute 3 times SD of duration
mean_duration<-mean(df$Duration__in_seconds_) #compute mean duration
cut_duration<-mean_duration-sd_duration #minimum time cut-off = mean time - three SD
df<-subset(df,df$Duration__in_seconds_>=cut_duration) #filter out cases with shorter usage
#N after time exclusion:
```

## exclude by missed attention checks (3 attention checks) (deactivated in simulation)
```{r}
#the survey included 3 attention checks; incorrectly responding to one of these will lead to exclusion from the final dataset
#df<-subset(df, AT_1 == 5)
#df<-subset(df, AT_2 == 1)
#df<-subset(df, AT_3 == 3)

#N after attention exclusion (final N):
```

# Clean data
## exclude columns of attention checks
```{r}
#after the exclusion, we exclude the attention check columns from the dataset
df <- df %>% select(-c("AT_1", "AT_2", "AT_3"))
```

## TODOexclude non-needed columns
```{r}
#this will be updated, in case qualtrics attaches columns, which are not needed for the analysis
```
## recode variables
```{r}
#this chunk recodes variables which were reverse coded. These were marked with _R in the variable name
#as the different scales operate on different scale widths, we need to select the reversed items by scale, using the starting letters or the variables (e.g., SA for the self-actualization items)
#the code then 'takes' all variables, starting with 'SA' and ending with '_R' and recodes them, based on the specific scale (1 to 4 or 1 to 7 etc.)
#self-actualization
df <- df %>%
  mutate(across(grep("^SA_.*_R$", names(df), value = TRUE), ~case_when(
    . == 1 ~ 4,
    . == 2 ~ 3,
    . == 3 ~ 2,
    . == 4 ~ 1,
    TRUE ~ . # keeps original value if none of the above conditions are met
  )))

#vitality
df <- df %>%
  mutate(across(grep("^VI_.*_R$", names(df), value = TRUE), ~case_when(
    . == 1 ~ 7,
    . == 2 ~ 6,
    . == 3 ~ 5,
    . == 4 ~ 4,
    . == 5 ~ 3,
    . == 6 ~ 2,
    . == 7 ~ 1,
    TRUE ~ . # keeps original value if none of the above conditions are met
  )))

#depressive symptoms
df <- df %>%
  mutate(across(grep("CES_.*_R$", names(df), value = TRUE), ~case_when(
    . == 0 ~ 3,
    . == 1 ~ 2,
    . == 2 ~ 1,
    . == 3 ~ 0,
    TRUE ~ . # keeps original value if none of the above conditions are met
  )))

#trait anxiety
df <- df %>%
  mutate(across(grep("AN_.*_R$", names(df), value = TRUE), ~case_when(
    . == 4 ~ 1,
    . == 3 ~ 2,
    . == 2 ~ 3,
    . == 1 ~ 4,
    TRUE ~ . # keeps original value if none of the above conditions are met
  )))
```


## rename variables (remove _R from recode variables)
```{r}
#after recoding the variables (see chunk above), the marking of the reversed variables is no longer needed
#hence, the '_R' is removed from the variables names

#self-actualization
names(df) <- ifelse(grepl("^SA_", names(df)), gsub("_R$", "", names(df)), names(df))
#vitality
names(df) <- ifelse(grepl("^VI_", names(df)), gsub("_R$", "", names(df)), names(df))
#depressive symptoms
names(df) <- ifelse(grepl("^CES_", names(df)), gsub("_R$", "", names(df)), names(df))
#trait anxiety
names(df) <- ifelse(grepl("^AN_", names(df)), gsub("_R$", "", names(df)), names(df))


```

# Descriptives
## compute reliabilities
```{r}
#this chunk computes the reliabilities (cronbachs alpha) for all measures of interest in the study. By keeping the [[1]] in every line, only the alpha is reported
#to get more details on the item level, delete the [[1]]

###independent variables
#Aspiration index: importance
alpha_1 <- psych::alpha(df%>% select(starts_with("ASP_SAI")))[[1]]
alpha_2 <- psych::alpha(df%>% select(starts_with("ASP_AFI")))[[1]]
alpha_3 <- psych::alpha(df%>% select(starts_with("ASP_CFI")))[[1]]
alpha_4 <- psych::alpha(df%>% select(starts_with("ASP_FSI")))[[1]]

#Aspiration index: chances
alpha_5 <- psych::alpha(df%>% select(starts_with("ASP_SAC")))[[1]]
alpha_6 <- psych::alpha(df%>% select(starts_with("ASP_AFC")))[[1]]
alpha_7 <- psych::alpha(df%>% select(starts_with("ASP_CFC")))[[1]]
alpha_8 <- psych::alpha(df%>% select(starts_with("ASP_FSC")))[[1]]

#Guiding principles:
## money
alpha_9 <- psych::alpha(df%>%select(grep("^GPR_.*_1$", names(df), value = TRUE)))[[1]]
##family security
alpha_10 <- psych::alpha(df%>%select(grep("^GPR_.*_2$", names(df), value = TRUE)))[[1]]
##global welfare
alpha_11 <- psych::alpha(df%>%select(grep("^GPR_.*_3$", names(df), value = TRUE)))[[1]]
##spirituality
psych::alpha(df%>%select(grep("^GPR_.*_4$", names(df), value = TRUE)))[[1]]
##hedonism
psych::alpha(df%>%select(grep("^GPR_.*_5$", names(df), value = TRUE)))[[1]]

###dependent variables
#self-actualization
alpha_12 <- psych::alpha(df%>% select(starts_with("SA_")))[[1]]
#vitality
alpha_13 <- psych::alpha(df%>% select(starts_with("VI_")))[[1]]
#control orientation (only care about control-subscale)
alpha_14 <- psych::alpha(df%>%select(grep("^CO_.*_C$", names(df), value = TRUE)))[[1]]
#depressive symptoms
alpha_15 <- psych::alpha(df%>% select(starts_with("CES_")))[[1]]
#trait anxiety
alpha_16 <- psych::alpha(df%>% select(starts_with("AN_")))[[1]]

#save all needed reliabilties for reporting (this computes means and SD already)
reliabilities <- rbind(alpha_1, alpha_2, alpha_3, alpha_4,
                       alpha_5, alpha_6, alpha_7, alpha_8,
                       alpha_9, alpha_10, alpha_11, alpha_12,
                       alpha_13, alpha_14, alpha_15, alpha_16)

reliabilities$labels <- c("SAI", "AFI", "CFI", "FSI", "SAC", "AFC", "CFC", "FSC",
                          "gpr_money", "gpr_family", "gpr_welfare", "self_actualization",
                          "vitality", "control_orientation", "depressive_symptoms", "trait_anxiety")

#reduce to needed columns I
reliabilities <- reliabilities %>%
  select(c(labels, mean, sd, raw_alpha))

#round numeric values
reliabilities <- data.frame(lapply(reliabilities, function(x) if(is.numeric(x)) round(x, 2) else x))

#compute combined M (SD) column
reliabilities$M_SD <- paste(reliabilities$mean, " (", reliabilities$sd, ")", sep="")

#reduce to needed columns II
reliabilities <- reliabilities %>%
  select(c(labels, M_SD, raw_alpha))

#save relevant data and copy-paste to document (replace ',' with '.' in reliabilties and change e.g. 0.30 to .30)
write_xlsx(reliabilities[, c("M_SD", "raw_alpha")], "M_SD_rel_data.xlsx")

#exclude non-needed df
rm(list = c("alpha_1", "alpha_2", "alpha_3", "alpha_4",
            "alpha_5", "alpha_6", "alpha_7", "alpha_8",
            "alpha_9", "alpha_10", "alpha_11", "alpha_12",
            "alpha_13", "alpha_14", "alpha_15", "alpha_16"))
```

## demographics
```{r}
###describe age:
psych::describe(df$age)
ggplot(df,aes(y = age))+
  geom_boxplot()+
  theme_classic()

###describe best identified gender:
table(df$gender) #1 = male, 2 = female, 3 = other, 4 = rather not disclose


# Calculate the table and convert it to a data frame
gender_table <- table(df$gender)
gender_df <- data.frame(Category = names(gender_table), Count = as.integer(gender_table))

# Add a column for percentages
gender_df$Percentage <- (gender_df$Count / sum(gender_df$Count)) * 100

# Update Category names to be more descriptive
gender_df$Category <- factor(gender_df$Category, levels = c("1", "2", "3", "4"),
                             labels = c("Male", "Female", "Other", "Rather not disclose"))

# Plot
ggplot(gender_df, aes(x = Category, y = Percentage, fill = Category)) +
  geom_bar(stat = "identity") +
  scale_fill_brewer(palette = "Pastel1") + 
  labs(title = "Gender Distribution", x = "Gender", y = "Percentage (%)") +
  theme_classic() +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), vjust = -0.5)

```

## compute means
```{r}
#this chunk computes all needed means for the analysis
#first all independent variables, afterwards the dependent variables

###independent variables
#aspiration index: importances
df <- df %>% mutate(mean_asp_sai = rowMeans(select(., starts_with("ASP_SAI")), na.rm = TRUE))
df <- df %>% mutate(mean_asp_afi = rowMeans(select(., starts_with("ASP_AFI")), na.rm = TRUE))
df <- df %>% mutate(mean_asp_cfi = rowMeans(select(., starts_with("ASP_CFI")), na.rm = TRUE))
df <- df %>% mutate(mean_asp_fsi = rowMeans(select(., starts_with("ASP_FSI")), na.rm = TRUE))

#aspiration index: overall importance
df <- df %>%
  mutate(mean_asp_overall_importance = rowMeans(select(.,starts_with("ASP_SAI"),
                                                         starts_with("ASP_AFI"),
                                                         starts_with("ASP_CFI"),
                                                         starts_with("ASP_FSI")), 
                                                        na.rm = TRUE))
#aspiration index: chances
df <- df %>% mutate(mean_asp_sac = rowMeans(select(., starts_with("ASP_SAC")), na.rm = TRUE))
df <- df %>% mutate(mean_asp_afc = rowMeans(select(., starts_with("ASP_AFC")), na.rm = TRUE))
df <- df %>% mutate(mean_asp_cfc = rowMeans(select(., starts_with("ASP_CFC")), na.rm = TRUE))
df <- df %>% mutate(mean_asp_fsc = rowMeans(select(., starts_with("ASP_FSC")), na.rm = TRUE))

#aspiration index: overall chances
df <- df %>%
  mutate(mean_asp_overall_chances = rowMeans(select(.,starts_with("ASP_SAC"),
                                                         starts_with("ASP_AFC"),
                                                         starts_with("ASP_CFC"),
                                                         starts_with("ASP_FSC")), 
                                                        na.rm = TRUE))

#guiding principles: mean position in rank-ordering across three rankings
#money
df <- df %>% mutate(mean_gpr_money = 
                      rowMeans(select(., grep("^GPR_.*_1$", names(df), value = TRUE)), 
                      na.rm = TRUE))
#family security
df <- df %>% mutate(mean_gpr_family_security = 
                      rowMeans(select(., grep("^GPR_.*_2$", names(df), value = TRUE)), 
                      na.rm = TRUE))
#global welfare
df <- df %>% mutate(mean_gpr_global_welfare = 
                      rowMeans(select(., grep("^GPR_.*_3$", names(df), value = TRUE)), 
                      na.rm = TRUE))
#spirituality
df <- df %>% mutate(mean_gpr_spirituality = 
                      rowMeans(select(., grep("^GPR_.*_4$", names(df), value = TRUE)), 
                      na.rm = TRUE))
#hedonism
df <- df %>% mutate(mean_gpr_hedonism = 
                      rowMeans(select(., grep("^GPR_.*_5$", names(df), value = TRUE)), 
                      na.rm = TRUE))

###dependent variables
#self-actualization
df <- df %>% mutate(mean_self_actualization = 
                      rowMeans(select(., starts_with("SA_")), na.rm = TRUE))
#vitality
df <- df %>% mutate(mean_vitality = 
                      rowMeans(select(., starts_with("VI_")), na.rm = TRUE))
#control orientation
df <- df %>% mutate(mean_control_orientation = 
                      rowMeans(select(., grep("^CO_.*_C$", names(df), value = TRUE)), 
                      na.rm = TRUE))

#depressive symptoms
df <- df %>% mutate(mean_depressive_symptoms = 
                      rowMeans(select(., starts_with("CES_")), na.rm = TRUE))

#trait anxiety
df <- df %>% mutate(mean_trait_anxiety = 
                      rowMeans(select(., starts_with("AN_")), na.rm = TRUE))
```

## describe distribution of means
```{r}
#here we receive all relevant descriptive informations about the distribution properties of the means
#numerically describe all means
df_means <- df %>% select (starts_with("mean"))
df_means_describe <- psych::describe(df_means) #save descriptives in extra df: this contains detailed informations about all means (e.g., case number, Sd etc.)

#plot all means
long_df_means <- pivot_longer(df_means, cols = everything(), names_to = "variable", values_to = "value")

ggplot(long_df_means, aes(x = value)) +
  geom_histogram(bins = 30, fill = "blue", color = "black") +
  facet_wrap(~ variable, scales = "free_x") +
  theme_minimal() +
  labs(title = "Histograms of All Means", x = "Value", y = "Frequency")

```

## intercorrelations of means
```{r}
#here we create a correlation table between all means
df_means %>%
  correlation::correlation(p_adjust = "none")%>% #this disables any alpha corrections, but can be replace with other methods (https://rdrr.io/github/easystats/correlation/man/correlation.html)
  summary(redundant = TRUE) %>%
  plot()

df_means %>%
  correlation::correlation(p_adjust = "none")%>%
  filter(p < .05) #this is a subset with significant correlations at .05

df_means %>%
  correlation::correlation(p_adjust = "none")%>%
  filter(p < .001) #this is a subset with significant correlations at .001
  
```

# Analysis Kasser & Ryan (1993)
## Preliminary analysis
### MANOVA by gender with follow up t-tests & inter-corelations of importances and chances
```{r}
#exclude individuals which didn't indicate to identify as female/male
df_manova <- subset(df, gender < 3) 

#manova importances
manova_importances <- manova(cbind(mean_asp_sai,mean_asp_afi,mean_asp_cfi,mean_asp_fsi)
                             ~ gender, data = df_manova)
summary(manova_importances)
report::report(manova_importances)

#follow up t-tests
asp_gen_1 <- as.data.frame(report::report(t.test(mean_asp_sai ~gender, data = df_manova)))
asp_gen_2 <- as.data.frame(report::report(t.test(mean_asp_afi ~gender, data = df_manova)))
asp_gen_3 <- as.data.frame(report::report(t.test(mean_asp_cfi ~gender, data = df_manova)))
asp_gen_4 <- as.data.frame(report::report(t.test(mean_asp_fsi ~gender, data = df_manova)))

#manova chances
manova_chances <- manova(cbind(mean_asp_sac,mean_asp_afc,mean_asp_cfc,mean_asp_fsc)
                             ~ gender, data = df_manova)
summary(manova_chances)
report::report(manova_chances)

#follow up t-tests
asp_gen_5 <- as.data.frame(report::report(t.test(mean_asp_sac ~gender, data = df_manova)))
asp_gen_6 <- as.data.frame(report::report(t.test(mean_asp_afc ~gender, data = df_manova)))
asp_gen_7 <- as.data.frame(report::report(t.test(mean_asp_cfc ~gender, data = df_manova)))
asp_gen_8 <- as.data.frame(report::report(t.test(mean_asp_fsc ~gender, data = df_manova)))

#combine t-tests
asp_gen <- rbind(asp_gen_1, asp_gen_2, asp_gen_3, asp_gen_4,
                 asp_gen_5, asp_gen_6, asp_gen_7, asp_gen_8)

#reduce to needed variables I
asp_gen <- asp_gen %>%
  select(Parameter, Difference, t, d, CI_low, CI_high)

#round numeric values
asp_gen <- data.frame(lapply(asp_gen, function(x) if(is.numeric(x)) round(x, 2) else x))

#compute combined d [CI]
asp_gen$D_CI <- paste(asp_gen$d, " [", asp_gen$CI_low,", ", asp_gen$CI_high,"]", sep="")

#reduce to needed columns II
asp_gen <- asp_gen %>%
  select(c(Parameter, Difference, t, D_CI))

#save relevant data and copy-paste to document ()use text-to-column function and set each column as 'text' so nothing is trnasformed to a date)
write.csv(asp_gen, "gender_aspiration.csv")

#delete non-needed files
rm(list = c("asp_gen_1", "asp_gen_2", "asp_gen_3", "asp_gen_4",
            "asp_gen_5", "asp_gen_6", "asp_gen_7", "asp_gen_8"))





#these correlations have been computed above with the other means already
#this section was create to give a more focal perspective on these correlations
#intercorrelate all importances
df_importance <- df_means %>% select(ends_with("i"))

df_importance %>%
  correlation::correlation(p_adjust = "none") %>%
  summary(redundant = TRUE) 

df_importance %>%
  correlation::correlation(p_adjust = "none") 
  
#intercorrelate all chances
df_chance <- df_means %>% select(ends_with("c"))

df_chance %>%
  correlation::correlation(p_adjust = "none") %>%
  summary(redundant = TRUE) %>%
  plot()

df_chance %>%
  correlation::correlation(p_adjust = "none") 
```

### outcome by gender and aspiration interactions
```{r}
#this chunk runs all 40 proposed interction models by gender and aspirations

#select needed variables
df_interactions <- df %>%
  select(mean_asp_sai,mean_asp_afi,mean_asp_cfi,mean_asp_fsi,
         mean_asp_overall_importance,
         mean_asp_sac,mean_asp_afc,mean_asp_cfc,mean_asp_fsc,
         mean_asp_overall_chances,
         mean_self_actualization,
         mean_vitality,
         mean_control_orientation,
         mean_depressive_symptoms,
         mean_trait_anxiety,
         gender)

#transform gender to factor
df_interactions$gender <- as.factor(df_interactions$gender)

#self-actualization: importance
m1 <- lm(mean_self_actualization ~ mean_asp_overall_importance +
           mean_asp_sai*gender,data = df_interactions)
tab_model(m1,show.std = TRUE)

m2 <- lm(mean_self_actualization ~ mean_asp_overall_importance +
           mean_asp_afi*gender,data = df_interactions)
tab_model(m2,show.std = TRUE)

m3 <- lm(mean_self_actualization ~ mean_asp_overall_importance +
           mean_asp_cfi*gender,data = df_interactions)
tab_model(m3,show.std = TRUE)

m4 <- lm(mean_self_actualization ~ mean_asp_overall_importance +
           mean_asp_fsi*gender,data = df_interactions)
tab_model(m4,show.std = TRUE)

#self-actualization: chances
m1 <- lm(mean_self_actualization ~ mean_asp_overall_chances +
           mean_asp_sac*gender,data = df_interactions)
tab_model(m1,show.std = TRUE)

m2 <- lm(mean_self_actualization ~ mean_asp_overall_chances +
           mean_asp_afc*gender,data = df_interactions)
tab_model(m2,show.std = TRUE)

m3 <- lm(mean_self_actualization ~ mean_asp_overall_chances +
           mean_asp_cfc*gender,data = df_interactions)
tab_model(m3,show.std = TRUE)

m4 <- lm(mean_self_actualization ~ mean_asp_overall_chances +
           mean_asp_fsc*gender,data = df_interactions)
tab_model(m4,show.std = TRUE)

#vitality: importance
m1 <- lm(mean_vitality ~ mean_asp_overall_importance +
           mean_asp_sai*gender,data = df_interactions)
tab_model(m1,show.std = TRUE)

m2 <- lm(mean_vitality ~ mean_asp_overall_importance +
           mean_asp_afi*gender,data = df_interactions)
tab_model(m2,show.std = TRUE)

m3 <- lm(mean_vitality ~ mean_asp_overall_importance +
           mean_asp_cfi*gender,data = df_interactions)
tab_model(m3,show.std = TRUE)

m4 <- lm(mean_vitality ~ mean_asp_overall_importance +
           mean_asp_fsi*gender,data = df_interactions)
tab_model(m4,show.std = TRUE)

#vitality: chances
m1 <- lm(mean_vitality ~ mean_asp_overall_chances +
           mean_asp_sac*gender,data = df_interactions)
tab_model(m1,show.std = TRUE)

m2 <- lm(mean_vitality ~ mean_asp_overall_chances +
           mean_asp_afc*gender,data = df_interactions)
tab_model(m2,show.std = TRUE)

m3 <- lm(mean_vitality ~ mean_asp_overall_chances +
           mean_asp_cfc*gender,data = df_interactions)
tab_model(m3,show.std = TRUE)

m4 <- lm(mean_vitality ~ mean_asp_overall_chances +
           mean_asp_fsc*gender,data = df_interactions)
tab_model(m4,show.std = TRUE)

#control-orientation: importance
m1 <- lm(mean_control_orientation ~ mean_asp_overall_importance +
           mean_asp_sai*gender,data = df_interactions)
tab_model(m1,show.std = TRUE)

m2 <- lm(mean_control_orientation ~ mean_asp_overall_importance +
           mean_asp_afi*gender,data = df_interactions)
tab_model(m2,show.std = TRUE)

m3 <- lm(mean_control_orientation ~ mean_asp_overall_importance +
           mean_asp_cfi*gender,data = df_interactions)
tab_model(m3,show.std = TRUE)

m4 <- lm(mean_control_orientation ~ mean_asp_overall_importance +
           mean_asp_fsi*gender,data = df_interactions)
tab_model(m4,show.std = TRUE)

#control-orientation: chances
m1 <- lm(mean_control_orientation ~ mean_asp_overall_chances +
           mean_asp_sac*gender,data = df_interactions)
tab_model(m1,show.std = TRUE)

m2 <- lm(mean_control_orientation ~ mean_asp_overall_chances +
           mean_asp_afc*gender,data = df_interactions)
tab_model(m2,show.std = TRUE)

m3 <- lm(mean_control_orientation ~ mean_asp_overall_chances +
           mean_asp_cfc*gender,data = df_interactions)
tab_model(m3,show.std = TRUE)

m4 <- lm(mean_control_orientation ~ mean_asp_overall_chances +
           mean_asp_fsc*gender,data = df_interactions)
tab_model(m4,show.std = TRUE)

#depressive-symptoms: importance
m1 <- lm(mean_depressive_symptoms ~ mean_asp_overall_importance +
           mean_asp_sai*gender,data = df_interactions)
tab_model(m1,show.std = TRUE)

m2 <- lm(mean_depressive_symptoms ~ mean_asp_overall_importance +
           mean_asp_afi*gender,data = df_interactions)
tab_model(m2,show.std = TRUE)

m3 <- lm(mean_depressive_symptoms ~ mean_asp_overall_importance +
           mean_asp_cfi*gender,data = df_interactions)
tab_model(m3,show.std = TRUE)

m4 <- lm(mean_depressive_symptoms ~ mean_asp_overall_importance +
           mean_asp_fsi*gender,data = df_interactions)
tab_model(m4,show.std = TRUE)

#depressive-symptoms: chances
m1 <- lm(mean_depressive_symptoms ~ mean_asp_overall_chances +
           mean_asp_sac*gender,data = df_interactions)
tab_model(m1,show.std = TRUE)

m2 <- lm(mean_depressive_symptoms ~ mean_asp_overall_chances +
           mean_asp_afc*gender,data = df_interactions)
tab_model(m2,show.std = TRUE)

m3 <- lm(mean_depressive_symptoms ~ mean_asp_overall_chances +
           mean_asp_cfc*gender,data = df_interactions)
tab_model(m3,show.std = TRUE)

m4 <- lm(mean_depressive_symptoms ~ mean_asp_overall_chances +
           mean_asp_fsc*gender,data = df_interactions)
tab_model(m4,show.std = TRUE)

#trait-anxiety: importance
m1 <- lm(mean_trait_anxiety ~ mean_asp_overall_importance +
           mean_asp_sai*gender,data = df_interactions)
tab_model(m1,show.std = TRUE)

m2 <- lm(mean_trait_anxiety ~ mean_asp_overall_importance +
           mean_asp_afi*gender,data = df_interactions)
tab_model(m2,show.std = TRUE)

m3 <- lm(mean_trait_anxiety ~ mean_asp_overall_importance +
           mean_asp_cfi*gender,data = df_interactions)
tab_model(m3,show.std = TRUE)

m4 <- lm(mean_trait_anxiety ~ mean_asp_overall_importance +
           mean_asp_fsi*gender,data = df_interactions)
tab_model(m4,show.std = TRUE)
summary(m4)

#trait-anxiety: chances
m1 <- lm(mean_trait_anxiety ~ mean_asp_overall_chances +
           mean_asp_sac*gender,data = df_interactions)
tab_model(m1,show.std = TRUE)

m2 <- lm(mean_trait_anxiety ~ mean_asp_overall_chances +
           mean_asp_afc*gender,data = df_interactions)
tab_model(m2,show.std = TRUE)

m3 <- lm(mean_trait_anxiety ~ mean_asp_overall_chances +
           mean_asp_cfc*gender,data = df_interactions)
tab_model(m3,show.std = TRUE)

m4 <- lm(mean_trait_anxiety ~ mean_asp_overall_chances +
           mean_asp_fsc*gender,data = df_interactions)
tab_model(m4,show.std = TRUE)

```

## Primary analysis

### define function to extract regression results

```{r}
extractModelStatistics <- function(model) {
  # Extract coefficients
  standardized_betas <- coef(model)
  
  # Extract confidence intervals
  standardized_cis <- confint(model, level = 0.95)
  standardized_cis <- setNames(as.data.frame(standardized_cis), c("Lower", "Upper"))
  rownames(standardized_cis) <- names(standardized_betas)
  
  # Extract p-values
  summary_model <- summary(model)
  p_values <- summary_model$coefficients[, "Pr(>|t|)"]
  
  # Create a data frame for coefficients and their names
  results <- data.frame(Estimate = standardized_betas, row.names = names(standardized_betas))
  
  # Add confidence intervals and p-values by matching row names
  results$Lower <- standardized_cis[rownames(results), "Lower"]
  results$Upper <- standardized_cis[rownames(results), "Upper"]
  results$P_Value <- p_values[rownames(results)]
  
  # Optionally drop rows with NA
  results <- na.omit(results)
  
  return(results)
}
```

### preparation for analysis
```{r}
#create standardized dataframe with means
df_means_scaled <- as.data.frame(scale(df_means))

#create names list which will be assigned often
names_corr <- c("DV", "IV", "r", "ci_low", "ci_high", "p")
names_regr <- c("beta", "ci_low", "ci_high", "p")
```


### regressions and correlations (DV by aspiration importance)
```{r}
#self-actualization - importance
df_SA_I <- df_means_scaled %>% select(c(mean_self_actualization, #create specific df for analysis
                                      mean_asp_overall_importance,
                                      mean_asp_sai,
                                      mean_asp_afi,
                                      mean_asp_fsi,
                                      mean_asp_cfi))

m1 <- lm(mean_self_actualization ~.,data = df_SA_I) #compute model

results_SA_I <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_SA_I) <- names_regr #rename dataframe with extracted results
results_SA_I$DV <- rep("SA",nrow(results_SA_I))

#get correlations

correlation_SA_I <- df_SA_I %>%
  correlation::correlation(p_adjust = "none")

correlation_SA_I  <- correlation_SA_I [1:5,]
correlation_SA_I <- as.data.frame(cbind(correlation_SA_I$Parameter1,
                                      correlation_SA_I$Parameter2,
                                      round(correlation_SA_I$r,3),
                                      round(correlation_SA_I$CI_low,3),
                                      round(correlation_SA_I$CI_high,3),
                                      round(correlation_SA_I$p,3)))

names(correlation_SA_I) <- names_corr


#vitality - importance
df_VI_I <- df_means_scaled %>% select(c(mean_vitality, #create specific df for analysis
                                      mean_asp_overall_importance,
                                      mean_asp_sai,
                                      mean_asp_afi,
                                      mean_asp_fsi,
                                      mean_asp_cfi))

m1 <- lm(mean_vitality ~.,data = df_VI_I) #compute model

results_VI_I <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_VI_I) <- names_regr #rename dataframe with extracted results
results_VI_I$DV <- rep("VI",nrow(results_VI_I))

#get correlations

correlation_VI_I <- df_VI_I %>%
  correlation::correlation(p_adjust = "none")

correlation_VI_I  <- correlation_VI_I [1:5,]
correlation_VI_I <- as.data.frame(cbind(correlation_VI_I$Parameter1,
                                      correlation_VI_I$Parameter2,
                                      round(correlation_VI_I$r,3),
                                      round(correlation_VI_I$CI_low,3),
                                      round(correlation_VI_I$CI_high,3),
                                      round(correlation_VI_I$p,3)))

names(correlation_VI_I) <- names_corr

#control orientation - importance
df_CO_I <- df_means_scaled %>% select(c(mean_control_orientation, #create specific df for analysis
                                      mean_asp_overall_importance,
                                      mean_asp_sai,
                                      mean_asp_afi,
                                      mean_asp_fsi,
                                      mean_asp_cfi))

m1 <- lm(mean_control_orientation ~.,data = df_CO_I) #compute model

results_CO_I <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_CO_I) <- names_regr #rename dataframe with extracted results
results_CO_I$DV <- rep("CO",nrow(results_CO_I))

#get correlations
correlation_CO_I <- df_CO_I %>%
  correlation::correlation(p_adjust = "none")

correlation_CO_I  <- correlation_CO_I [1:5,]
correlation_CO_I <- as.data.frame(cbind(correlation_CO_I$Parameter1,
                                      correlation_CO_I$Parameter2,
                                      round(correlation_CO_I$r,3),
                                      round(correlation_CO_I$CI_low,3),
                                      round(correlation_CO_I$CI_high,3),
                                      round(correlation_CO_I$p,3)))

names(correlation_CO_I) <- names_corr

#depressive symptoms - importance
df_DS_I <- df_means_scaled %>% select(c(mean_depressive_symptoms, #create specific df for analysis
                                      mean_asp_overall_importance,
                                      mean_asp_sai,
                                      mean_asp_afi,
                                      mean_asp_fsi,
                                      mean_asp_cfi))

m1 <- lm(mean_depressive_symptoms ~.,data = df_DS_I) #compute model

results_DS_I <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_DS_I) <- names_regr #rename dataframe with extracted results
results_DS_I$DV <- rep("DS",nrow(results_DS_I))

#get correlations
correlation_DS_I <- df_DS_I %>%
  correlation::correlation(p_adjust = "none")

correlation_DS_I  <- correlation_DS_I [1:5,]
correlation_DS_I <- as.data.frame(cbind(correlation_DS_I$Parameter1,
                                      correlation_DS_I$Parameter2,
                                      round(correlation_DS_I$r,3),
                                      round(correlation_DS_I$CI_low,3),
                                      round(correlation_DS_I$CI_high,3),
                                      round(correlation_DS_I$p,3)))

names(correlation_DS_I) <- names_corr

#trait anxiety - importance
df_TA_I <- df_means_scaled %>% select(c(mean_trait_anxiety, #create specific df for analysis
                                      mean_asp_overall_importance,
                                      mean_asp_sai,
                                      mean_asp_afi,
                                      mean_asp_fsi,
                                      mean_asp_cfi))

m1 <- lm(mean_trait_anxiety ~.,data = df_TA_I) #compute model

results_TA_I <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_TA_I) <- names_regr #rename dataframe with extracted results
results_TA_I$DV <- rep("TA",nrow(results_TA_I))

#get correlations
correlation_TA_I <- df_TA_I %>%
  correlation::correlation(p_adjust = "none")

correlation_TA_I  <- correlation_TA_I [1:5,]
correlation_TA_I <- as.data.frame(cbind(correlation_TA_I$Parameter1,
                                      correlation_TA_I$Parameter2,
                                      round(correlation_TA_I$r,3),
                                      round(correlation_TA_I$CI_low,3),
                                      round(correlation_TA_I$CI_high,3),
                                      round(correlation_TA_I$p,3)))

names(correlation_TA_I) <- names_corr
```

#### get results in dataframes, to preocess later in forestplot (importance)
```{r}
#regression results
results_regr_asp_importance <- rbind(results_SA_I,
                                     results_VI_I,
                                     results_CO_I,
                                     results_DS_I,
                                     results_TA_I)

#correlation results
results_corr_asp_importance <-rbind(correlation_SA_I,
                                    correlation_VI_I,
                                    correlation_CO_I,
                                    correlation_DS_I,
                                    correlation_TA_I)


#remove dataframes which aren't needed anymore
rm(list=c("results_SA_I", "results_VI_I", "results_CO_I", "results_DS_I", "results_TA_I","df_SA_I","df_VI_I","df_CO_I","df_DS_I","df_TA_I",
          "correlation_SA_I","correlation_VI_I","correlation_CO_I","correlation_DS_I","correlation_TA_I"))
```

### regressions and correlations (DV by aspiration chances)
```{r}
#self-actualization - chances
df_SA_C <- df_means_scaled %>% select(c(mean_self_actualization, #create specific df for analysis
                                      mean_asp_overall_chances,
                                      mean_asp_sac,
                                      mean_asp_afc,
                                      mean_asp_fsc,
                                      mean_asp_cfc))

m1 <- lm(mean_self_actualization ~.,data = df_SA_C) #compute model

results_SA_C <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_SA_C) <- names_regr #rename dataframe with extracted results
results_SA_C$DV <- rep("SA",nrow(results_SA_C))

#get correlations

correlation_SA_C <- df_SA_C %>%
  correlation::correlation(p_adjust = "none")

correlation_SA_C  <- correlation_SA_C [1:5,]
correlation_SA_C <- as.data.frame(cbind(correlation_SA_C$Parameter1,
                                      correlation_SA_C$Parameter2,
                                      round(correlation_SA_C$r,3),
                                      round(correlation_SA_C$CI_low,3),
                                      round(correlation_SA_C$CI_high,3),
                                      round(correlation_SA_C$p,3)))

names(correlation_SA_C) <- names_corr


#vitality - chances
df_VI_C <- df_means_scaled %>% select(c(mean_vitality, #create specific df for analysis
                                      mean_asp_overall_chances,
                                      mean_asp_sac,
                                      mean_asp_afc,
                                      mean_asp_fsc,
                                      mean_asp_cfc))

m1 <- lm(mean_vitality ~.,data = df_VI_C) #compute model

results_VI_C <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_VI_C) <- names_regr #rename dataframe with extracted results
results_VI_C$DV <- rep("VI",nrow(results_VI_C))

#get correlations

correlation_VI_C <- df_VI_C %>%
  correlation::correlation(p_adjust = "none")

correlation_VI_C  <- correlation_VI_C [1:5,]
correlation_VI_C <- as.data.frame(cbind(correlation_VI_C$Parameter1,
                                      correlation_VI_C$Parameter2,
                                      round(correlation_VI_C$r,3),
                                      round(correlation_VI_C$CI_low,3),
                                      round(correlation_VI_C$CI_high,3),
                                      round(correlation_VI_C$p,3)))

names(correlation_VI_C) <- names_corr

#control orientation - chances
df_CO_C <- df_means_scaled %>% select(c(mean_control_orientation, #create specific df for analysis
                                      mean_asp_overall_chances,
                                      mean_asp_sac,
                                      mean_asp_afc,
                                      mean_asp_fsc,
                                      mean_asp_cfc))

m1 <- lm(mean_control_orientation ~.,data = df_CO_C) #compute model

results_CO_C <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_CO_C) <- names_regr #rename dataframe with extracted results
results_CO_C$DV <- rep("CO",nrow(results_CO_C))

#get correlations
correlation_CO_C <- df_CO_C %>%
  correlation::correlation(p_adjust = "none")

correlation_CO_C  <- correlation_CO_C [1:5,]
correlation_CO_C <- as.data.frame(cbind(correlation_CO_C$Parameter1,
                                      correlation_CO_C$Parameter2,
                                      round(correlation_CO_C$r,3),
                                      round(correlation_CO_C$CI_low,3),
                                      round(correlation_CO_C$CI_high,3),
                                      round(correlation_CO_C$p,3)))

names(correlation_CO_C) <- names_corr

#depressive symptoms - chances
df_DS_C <- df_means_scaled %>% select(c(mean_depressive_symptoms, #create specific df for analysis
                                      mean_asp_overall_chances,
                                      mean_asp_sac,
                                      mean_asp_afc,
                                      mean_asp_fsc,
                                      mean_asp_cfc))

m1 <- lm(mean_depressive_symptoms ~.,data = df_DS_C) #compute model

results_DS_C <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_DS_C) <- names_regr #rename dataframe with extracted results
results_DS_C$DV <- rep("DS",nrow(results_DS_C))

#get correlations
correlation_DS_C <- df_DS_C %>%
  correlation::correlation(p_adjust = "none")

correlation_DS_C  <- correlation_DS_C [1:5,]
correlation_DS_C <- as.data.frame(cbind(correlation_DS_C$Parameter1,
                                      correlation_DS_C$Parameter2,
                                      round(correlation_DS_C$r,3),
                                      round(correlation_DS_C$CI_low,3),
                                      round(correlation_DS_C$CI_high,3),
                                      round(correlation_DS_C$p,3)))

names(correlation_DS_C) <- names_corr

#trait anxiety - chances
df_TA_C <- df_means_scaled %>% select(c(mean_trait_anxiety, #create specific df for analysis
                                      mean_asp_overall_chances,
                                      mean_asp_sac,
                                      mean_asp_afc,
                                      mean_asp_fsc,
                                      mean_asp_cfc))

m1 <- lm(mean_trait_anxiety ~.,data = df_TA_C) #compute model

results_TA_C <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_TA_C) <- names_regr #rename dataframe with extracted results
results_TA_C$DV <- rep("TA",nrow(results_TA_C))

#get correlations
correlation_TA_C <- df_TA_C %>%
  correlation::correlation(p_adjust = "none")

correlation_TA_C  <- correlation_TA_C [1:5,]
correlation_TA_C <- as.data.frame(cbind(correlation_TA_C$Parameter1,
                                      correlation_TA_C$Parameter2,
                                      round(correlation_TA_C$r,3),
                                      round(correlation_TA_C$CI_low,3),
                                      round(correlation_TA_C$CI_high,3),
                                      round(correlation_TA_C$p,3)))

names(correlation_TA_C) <- names_corr
```

#### get results in dataframes, to preocess later in forestplot (chances)
```{r}
#regression results
results_regr_asp_chances <- rbind(results_SA_C,
                                     results_VI_C,
                                     results_CO_C,
                                     results_DS_C,
                                     results_TA_C)

#correlation results
results_corr_asp_chances <-rbind(correlation_SA_C,
                                    correlation_VI_C,
                                    correlation_CO_C,
                                    correlation_DS_C,
                                    correlation_TA_C)


#remove dataframes which aren't needed anymore
rm(list=c("results_SA_C", "results_VI_C", "results_CO_C", "results_DS_C", "results_TA_C","df_SA_C","df_VI_C","df_CO_C","df_DS_C","df_TA_C",
          "correlation_SA_C","correlation_VI_C","correlation_CO_C",
          "correlation_DS_C","correlation_TA_C"))
```

#### combine dataframes with effects and plot
```{r}
#combine regression results
results_regr_asp_importance$dimension <- rep("importance",nrow(results_regr_asp_importance))
results_regr_asp_chances$dimension <- rep("chances",nrow(results_regr_asp_chances))

#contains all regression results from above
results_regr_aspiration <- rbind(results_regr_asp_importance, results_regr_asp_chances)

#makes rownames in usable column
results_regr_aspiration$labels <- rownames(results_regr_aspiration)

#plotting
reg_asp_plot_data <- results_regr_aspiration

reg_asp_plot_data$combined_label <- with(reg_asp_plot_data, paste(DV, labels, sep = ": "))

# To preserve the original order, convert combined_label directly to a factor
# without changing the levels based on unique values or any sorting
reg_asp_plot_data$combined_label <- factor(reg_asp_plot_data$combined_label, levels = reg_asp_plot_data$combined_label)

# Now, plot using ggplot2 without reordering
ggplot(reg_asp_plot_data, aes(x = beta, y = combined_label, color = dimension)) +
  geom_point() +  # Add points for beta values
  geom_errorbarh(aes(xmin = ci_low, xmax = ci_high), height = 0.2) +  # Add horizontal error bars for CIs
  facet_wrap(~dimension, scales = "free_y", ncol = 1, strip.position = "left") +  # Group by 'dimension'
  theme_minimal() +  # Use a minimal theme for aesthetics
  labs(x = "Effect Size (Beta)", y = "") +  # Label the x-axis, remove y-axis label
  theme(legend.position = "none",  # Remove legend
        panel.spacing = unit(1, "lines"),  # Adjust spacing between panels
        axis.text.y = element_text(size = rel(0.8)),  # Adjust y-axis text size if needed
        strip.background = element_blank(),  # Optional: remove facet label background
        strip.text.y = element_text(size = rel(1.2)))  # Adjust facet label text size

#combine correlation results
results_corr_asp_importance$dimension <- rep("importance",nrow(results_corr_asp_importance))
results_corr_asp_chances$dimension <- rep("chances",nrow(results_corr_asp_chances))

#contains all correlation results from above
results_corr_aspiration <- rbind(results_corr_asp_importance, results_corr_asp_chances)

#we have usable row names already here

corr_asp_plot_data <- results_corr_aspiration

corr_asp_plot_data$r <- as.numeric(corr_asp_plot_data$r)
corr_asp_plot_data$ci_low <- as.numeric(corr_asp_plot_data$ci_low)
corr_asp_plot_data$ci_high <- as.numeric(corr_asp_plot_data$ci_high)

# Create a combined label for plotting
corr_asp_plot_data$combined_label <- with(corr_asp_plot_data, paste(DV, IV, sep = ": "))

# Convert the combined_label to a factor to maintain the original order
corr_asp_plot_data$combined_label <- factor(corr_asp_plot_data$combined_label, 
                                            levels = unique(corr_asp_plot_data$combined_label))

# Create the forest plot with correct confidence intervals
ggplot(corr_asp_plot_data, aes(x = r, y = combined_label, color = dimension)) +
  geom_point() +  # Plot the correlation coefficients as points
  geom_errorbarh(aes(xmin = ci_low, xmax = ci_high), height = 0.2) +  # Draw horizontal error bars for CIs
  facet_wrap(~dimension, scales = "free_y", ncol = 1) +  # Group by 'dimension'
  theme_minimal() +  # Use a minimal theme for a clean look
  labs(x = "Correlation Coefficient (r)", y = "") +  # Label the x-axis
  theme(axis.text.y = element_text(size = rel(0.8)),  # Adjust y-axis text size
        legend.position = "none",  # Remove the legend
        strip.background = element_blank(),  # Remove facet label background for a cleaner look
        strip.text.y = element_text(size = rel(1.2)))  # Adjust facet label text size for readability

#remove dataframes which aren't needed anymore
rm(list=c("results_regr_asp_importance",
          "results_regr_asp_chances", 
          "results_corr_asp_importance", 
          "results_corr_asp_chances"))

#these show the distribution of effects by frequency
hist(results_regr_aspiration$beta)
hist(as.numeric(results_corr_aspiration$r))
```

### group comparisons (assessment of relative centrality)
```{r}
#function to compute SDs by group
calculate_group_sd <- function(data, group_var, numeric_var) {
  # Ensure the group variable is a factor and adjust levels to start from 1
  data <- data %>%
    mutate(!!sym(group_var) := factor(!!sym(group_var), levels = c(0, 1), labels = c("1", "2")))
  
  # Calculate SDs and pivot to get them in one row
  group_stats <- data %>%
    group_by(!!sym(group_var)) %>%
    summarise(
      SD = sd(!!sym(numeric_var), na.rm = TRUE),
      .groups = 'drop'
    ) %>%
    pivot_wider(names_prefix = "SD_Group_", names_from = !!sym(group_var), values_from = SD)
  
  return(group_stats)
}

#scale all aspiration index means
df_centr_asp <- df %>%
  mutate(across(starts_with("mean_asp"), 
                ~scale(.) %>% as.vector, 
                .names = "{.col}_z"))

#create binary variables by comparing z-score by person
#1 = higher z-score for financial success
df_centr_asp <- df_centr_asp %>% mutate(comp_fsi_afi = if_else(mean_asp_fsi_z > mean_asp_afi_z, 1, 0))
df_centr_asp <- df_centr_asp %>% mutate(comp_fsi_sai = if_else(mean_asp_fsi_z > mean_asp_sai_z, 1, 0))
df_centr_asp <- df_centr_asp %>% mutate(comp_fsi_cfi = if_else(mean_asp_fsi_z > mean_asp_cfi_z, 1, 0))

df_centr_asp <- df_centr_asp %>% mutate(comp_fsc_afc = if_else(mean_asp_fsc_z > mean_asp_afc_z, 1, 0))
df_centr_asp <- df_centr_asp %>% mutate(comp_fsc_sac = if_else(mean_asp_fsc_z > mean_asp_sac_z, 1, 0))
df_centr_asp <- df_centr_asp %>% mutate(comp_fsc_cfc = if_else(mean_asp_fsc_z > mean_asp_cfc_z, 1, 0))


#t-tests
##self-actualization - importance
test_1 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_fsi_afi, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_afi", "mean_self_actualization")
test_1 <- cbind(test_1, group_stats)

test_2 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_fsi_sai, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_sai", "mean_self_actualization")
test_2 <- cbind(test_2, group_stats)

test_3 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_fsi_cfi, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_cfi", "mean_self_actualization")
test_3 <- cbind(test_3, group_stats)

##self-actualization - chances
test_4 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_fsc_afc, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_afc", "mean_self_actualization")
test_4 <- cbind(test_4, group_stats)

test_5 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_fsc_sac, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_sac", "mean_self_actualization")
test_5 <- cbind(test_5, group_stats)

test_6 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_fsc_cfc, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_cfc", "mean_self_actualization")
test_6 <- cbind(test_6, group_stats)

##vitality - importance
test_7 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_fsi_afi, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_afi", "mean_vitality")
test_7 <- cbind(test_7, group_stats)

test_8 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_fsi_sai, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_sai", "mean_vitality")
test_8 <- cbind(test_8, group_stats)

test_9 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_fsi_cfi, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_cfi", "mean_vitality")
test_9 <- cbind(test_9, group_stats)

##vitality - chances
test_10 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_fsc_afc, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_afc", "mean_vitality")
test_10 <- cbind(test_10, group_stats)

test_11 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_fsc_sac, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_sac", "mean_vitality")
test_11 <- cbind(test_11, group_stats)

test_12 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_fsc_cfc, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_cfc", "mean_vitality")
test_12 <- cbind(test_12, group_stats)

##control-orientation - importance
test_13 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_fsi_afi, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_afi", "mean_control_orientation")
test_13 <- cbind(test_13, group_stats)

test_14 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_fsi_sai, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_sai", "mean_control_orientation")
test_14 <- cbind(test_14, group_stats)

test_15 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_fsi_cfi, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_cfi", "mean_control_orientation")
test_15 <- cbind(test_15, group_stats)

##control-orientation - chances
test_16 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_fsc_afc, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_afc", "mean_control_orientation")
test_16 <- cbind(test_16, group_stats)

test_17 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_fsc_sac, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_sac", "mean_control_orientation")
test_17 <- cbind(test_17, group_stats)

test_18 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_fsc_cfc, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_cfc", "mean_control_orientation")
test_18 <- cbind(test_18, group_stats)

##depressive symptoms - importance
test_19 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_fsi_afi, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_afi", "mean_depressive_symptoms")
test_19 <- cbind(test_19, group_stats)

test_20 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_fsi_sai, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_sai", "mean_depressive_symptoms")
test_20 <- cbind(test_20, group_stats)

test_21 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_fsi_cfi, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_cfi", "mean_depressive_symptoms")
test_21 <- cbind(test_21, group_stats)

##depressive symptoms - chances
test_22 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_fsc_afc, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_afc", "mean_depressive_symptoms")
test_22 <- cbind(test_22, group_stats)

test_23 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_fsc_sac, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_sac", "mean_depressive_symptoms")
test_23 <- cbind(test_23, group_stats)

test_24 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_fsc_cfc, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_cfc", "mean_depressive_symptoms")
test_24 <- cbind(test_24, group_stats)

# Trait Anxiety - Importance
test_25 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_fsi_afi, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_afi", "mean_trait_anxiety")
test_25 <- cbind(test_25, group_stats)

test_26 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_fsi_sai, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_sai", "mean_trait_anxiety")
test_26 <- cbind(test_26, group_stats)

test_27 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_fsi_cfi, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsi_cfi", "mean_trait_anxiety")
test_27 <- cbind(test_27, group_stats)

# Trait Anxiety - Chances
test_28 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_fsc_afc, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_afc", "mean_trait_anxiety")
test_28 <- cbind(test_28, group_stats)

test_29 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_fsc_sac, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_sac", "mean_trait_anxiety")
test_29 <- cbind(test_29, group_stats)

test_30 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_fsc_cfc, data = df_centr_asp)))
group_stats <- calculate_group_sd(df_centr_asp, "comp_fsc_cfc", "mean_trait_anxiety")
test_30 <- cbind(test_30, group_stats)

#combine results from all tests
results_t_test_aspiration <- do.call(rbind, list(test_1, test_2, test_3, test_4, test_5, test_6, test_7, test_8, test_9, test_10, 
                                                 test_11, test_12, test_13, test_14, test_15, test_16, test_17, test_18, test_19, test_20, 
                                                 test_21, test_22, test_23, test_24, test_25, test_26, test_27, test_28, test_29, test_30))
results_t_test_aspiration <- as.data.frame(results_t_test_aspiration)

# Remove the individual dataframes from environment
test_vars <- paste0("test_", 1:30)
rm(list = test_vars)

#plot effects
# Combine Parameter and Group into a new column for labeling
results_t_test_aspiration$Label <- paste(results_t_test_aspiration$Parameter, "-", results_t_test_aspiration$Group)

# Adjusting the plot to use the new Label column for y-axis labels
ggplot(results_t_test_aspiration, aes(x = Difference, y = Label)) +
  geom_point() +  # Add the mean difference as points
  geom_errorbarh(aes(xmin = CI_low, xmax = CI_high), height = 0.2) +  # Add CI as horizontal error bars
  labs(y = "Comparison", x = "Mean Difference") +  # Label the axes
  theme_minimal() +  # Use a minimal theme
  theme(axis.text.y = element_text(size = 7),  # Adjust text size for clarity if needed
        axis.title.y = element_blank())  # Remove the y-axis title for a cleaner look


hist(results_t_test_aspiration$d)

results_t_test_aspiration_05 <- subset(results_t_test_aspiration, p < .05)
```

### guiding principles correlations
```{r}
names_corr <- c("DV", "IV", "r", "ci_low", "ci_high", "p")

###correlations of mean rank-order of guiding principles with outcomes

#self-actualization - importance
df_SA_gpr <- df_means_scaled %>% select(c(mean_self_actualization, #create specific df for analysis
                                      mean_gpr_money,
                                      mean_gpr_family_security,
                                      mean_gpr_global_welfare))

#get correlations

correlation_SA_gpr <- df_SA_gpr %>%
  correlation::correlation(p_adjust = "none")

correlation_SA_gpr  <- correlation_SA_gpr [1:3,]
correlation_SA_gpr <- as.data.frame(cbind(correlation_SA_gpr$Parameter1,
                                      correlation_SA_gpr$Parameter2,
                                      round(correlation_SA_gpr$r,3),
                                      round(correlation_SA_gpr$CI_low,3),
                                      round(correlation_SA_gpr$CI_high,3),
                                      round(correlation_SA_gpr$p,3)))

names(correlation_SA_gpr) <- names_corr


#vitality - importance
df_VI_gpr <- df_means_scaled %>% select(c(mean_vitality, #create specific df for analysis
                                      mean_gpr_money,
                                      mean_gpr_family_security,
                                      mean_gpr_global_welfare))

#get correlations

correlation_VI_gpr <- df_VI_gpr %>%
  correlation::correlation(p_adjust = "none")

correlation_VI_gpr  <- correlation_VI_gpr [1:3,]
correlation_VI_gpr <- as.data.frame(cbind(correlation_VI_gpr$Parameter1,
                                      correlation_VI_gpr$Parameter2,
                                      round(correlation_VI_gpr$r,3),
                                      round(correlation_VI_gpr$CI_low,3),
                                      round(correlation_VI_gpr$CI_high,3),
                                      round(correlation_VI_gpr$p,3)))

names(correlation_VI_gpr) <- names_corr

#control orientation - importance
df_CO_gpr <- df_means_scaled %>% select(c(mean_control_orientation, #create specific df for analysis
                                      mean_gpr_money,
                                      mean_gpr_family_security,
                                      mean_gpr_global_welfare))


#get correlations
correlation_CO_gpr <- df_CO_gpr %>%
  correlation::correlation(p_adjust = "none")

correlation_CO_gpr  <- correlation_CO_gpr [1:3,]
correlation_CO_gpr <- as.data.frame(cbind(correlation_CO_gpr$Parameter1,
                                      correlation_CO_gpr$Parameter2,
                                      round(correlation_CO_gpr$r,3),
                                      round(correlation_CO_gpr$CI_low,3),
                                      round(correlation_CO_gpr$CI_high,3),
                                      round(correlation_CO_gpr$p,3)))

names(correlation_CO_gpr) <- names_corr

#depressive symptoms - importance
df_DS_gpr <- df_means_scaled %>% select(c(mean_depressive_symptoms, #create specific df for analysis
                                      mean_gpr_money,
                                      mean_gpr_family_security,
                                      mean_gpr_global_welfare))

#get correlations
correlation_DS_gpr <- df_DS_gpr %>%
  correlation::correlation(p_adjust = "none")

correlation_DS_gpr  <- correlation_DS_gpr [1:3,]
correlation_DS_gpr <- as.data.frame(cbind(correlation_DS_gpr$Parameter1,
                                      correlation_DS_gpr$Parameter2,
                                      round(correlation_DS_gpr$r,3),
                                      round(correlation_DS_gpr$CI_low,3),
                                      round(correlation_DS_gpr$CI_high,3),
                                      round(correlation_DS_gpr$p,3)))

names(correlation_DS_gpr) <- names_corr

#trait anxiety - importance
df_TA_gpr <- df_means_scaled %>% select(c(mean_trait_anxiety, #create specific df for analysis
                                      mean_gpr_money,
                                      mean_gpr_family_security,
                                      mean_gpr_global_welfare))

#get correlations
correlation_TA_gpr <- df_TA_gpr %>%
  correlation::correlation(p_adjust = "none")

correlation_TA_gpr  <- correlation_TA_gpr [1:3,]
correlation_TA_gpr <- as.data.frame(cbind(correlation_TA_gpr$Parameter1,
                                      correlation_TA_gpr$Parameter2,
                                      round(correlation_TA_gpr$r,3),
                                      round(correlation_TA_gpr$CI_low,3),
                                      round(correlation_TA_gpr$CI_high,3),
                                      round(correlation_TA_gpr$p,3)))

names(correlation_TA_gpr) <- names_corr

```

#### combine correlative findings and plot

```{r}
#correlation results
results_corr_gpr <- rbind(correlation_SA_gpr,
                          correlation_VI_gpr,
                          correlation_CO_gpr,
                          correlation_DS_gpr,
                          correlation_TA_gpr)

#remove non-needed dataframes

rm(list = c("correlation_SA_gpr",
            "correlation_VI_gpr",
            "correlation_CO_gpr",
            "correlation_DS_gpr",
            "correlation_TA_gpr"))

#we have usable row names already here

corr_gpr_plot_data <- results_corr_gpr

corr_gpr_plot_data$r <- as.numeric(corr_gpr_plot_data$r)
corr_gpr_plot_data$ci_low <- as.numeric(corr_gpr_plot_data$ci_low)
corr_gpr_plot_data$ci_high <- as.numeric(corr_gpr_plot_data$ci_high)

# Create a combined label for plotting
corr_gpr_plot_data$combined_label <- with(corr_gpr_plot_data, paste(DV, IV, sep = ": "))

# Convert the combined_label to a factor to maintain the original order
corr_gpr_plot_data$combined_label <- factor(corr_gpr_plot_data$combined_label, 
                                            levels = unique(corr_gpr_plot_data$combined_label))

# Create the forest plot with correct confidence intervals
ggplot(corr_gpr_plot_data, aes(x = r, y = combined_label)) +
  geom_point() +  # Plot the correlation coefficients as points
  geom_errorbarh(aes(xmin = ci_low, xmax = ci_high), height = 0.2) +  # Draw horizontal error bars for CIs
  theme_minimal() +  # Use a minimal theme for a clean look
  labs(x = "Correlation Coefficient (r)", y = "") +  # Label the x-axis
  theme(axis.text.y = element_text(size = rel(0.8)),  # Adjust y-axis text size
        legend.position = "none",  # Remove the legend
        strip.background = element_blank(),  # Remove facet label background for a cleaner look
        strip.text.y = element_text(size = rel(1.2)))  # Adjust facet label text size for readability
```





### guiding principles comparisons
```{r}
#function to compute SDs by group
calculate_group_sd <- function(data, group_var, numeric_var) {
  # Ensure the group variable is a factor and adjust levels to start from 1
  data <- data %>%
    mutate(!!sym(group_var) := factor(!!sym(group_var), levels = c(0, 1), labels = c("1", "2")))
  
  # Calculate SDs and pivot to get them in one row
  group_stats <- data %>%
    group_by(!!sym(group_var)) %>%
    summarise(
      SD = sd(!!sym(numeric_var), na.rm = TRUE),
      .groups = 'drop'
    ) %>%
    pivot_wider(names_prefix = "SD_Group_", names_from = !!sym(group_var), values_from = SD)
  
  return(group_stats)
}

#scale all guiding principles means
df_centr_gpr <- df %>%
  mutate(across(starts_with("mean_gpr"), 
                ~scale(.) %>% as.vector, 
                .names = "{.col}_z"))

#create binary variables by comparing z-score by person
#1 = higher z-score for financial success
df_centr_gpr <- df_centr_gpr %>% mutate(comp_money_family = if_else(mean_gpr_money_z > mean_gpr_family_security_z, 1, 0))
df_centr_gpr <- df_centr_gpr %>% mutate(comp_money_welfare = if_else(mean_gpr_money_z > mean_gpr_global_welfare_z, 1, 0))

#t-tests
##self-actualization
test_1 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_money_family,data = df_centr_gpr)))
group_stats <- calculate_group_sd(df_centr_gpr, "comp_money_family", "mean_self_actualization")
test_1 <- cbind(test_1, group_stats)

test_2 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_money_welfare,data = df_centr_gpr)))
group_stats <- calculate_group_sd(df_centr_gpr, "comp_money_welfare", "mean_self_actualization")
test_2 <- cbind(test_2, group_stats)

##vitality
test_3 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_money_family,data = df_centr_gpr)))
group_stats <- calculate_group_sd(df_centr_gpr, "comp_money_family", "mean_vitality")
test_3 <- cbind(test_3, group_stats)

test_4 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_money_welfare,data = df_centr_gpr)))
group_stats <- calculate_group_sd(df_centr_gpr, "comp_money_welfare", "mean_vitality")
test_4 <- cbind(test_4, group_stats)

##control orientation
test_5 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_money_family,data = df_centr_gpr)))
group_stats <- calculate_group_sd(df_centr_gpr, "comp_money_family", "mean_control_orientation")
test_5 <- cbind(test_5, group_stats)

test_6 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_money_welfare,data = df_centr_gpr)))
group_stats <- calculate_group_sd(df_centr_gpr, "comp_money_welfare", "mean_control_orientation")
test_6 <- cbind(test_6, group_stats)

##depressive symptoms
test_7 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_money_family,data = df_centr_gpr)))
group_stats <- calculate_group_sd(df_centr_gpr, "comp_money_family", "mean_depressive_symptoms")
test_7 <- cbind(test_7, group_stats)

test_8 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_money_welfare,data = df_centr_gpr)))
group_stats <- calculate_group_sd(df_centr_gpr, "comp_money_welfare", "mean_depressive_symptoms")
test_8 <- cbind(test_8, group_stats)

##trait anxiety
test_9 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_money_family,data = df_centr_gpr)))
group_stats <- calculate_group_sd(df_centr_gpr, "comp_money_family", "mean_trait_anxiety")
test_9 <- cbind(test_9, group_stats)

test_10 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_money_welfare,data = df_centr_gpr)))
group_stats <- calculate_group_sd(df_centr_gpr, "comp_money_welfare", "mean_trait_anxiety")
test_10 <- cbind(test_10, group_stats)

#combine results from all tests
results_t_test_gpr <- do.call(rbind, list(test_1, test_2, test_3, test_4, test_5, test_6, test_7, test_8, test_9, test_10))
results_t_test_gpr <- as.data.frame(results_t_test_gpr)

# Remove the individual dataframes from environment
test_vars <- paste0("test_", 1:10)
rm(list = test_vars)

#plot effects
# Combine Parameter and Group into a new column for labeling
results_t_test_gpr$Label <- paste(results_t_test_gpr$Parameter, "-", results_t_test_gpr$Group)

# Adjusting the plot to use the new Label column for y-axis labels
ggplot(results_t_test_gpr, aes(x = Difference, y = Label)) +
  geom_point() +  # Add the mean difference as points
  geom_errorbarh(aes(xmin = CI_low, xmax = CI_high), height = 0.2) +  # Add CI as horizontal error bars
  labs(y = "Comparison", x = "Mean Difference") +  # Label the axes
  theme_minimal() +  # Use a minimal theme
  theme(axis.text.y = element_text(size = 7),  # Adjust text size for clarity if needed
        axis.title.y = element_blank())  # Remove the y-axis title for a cleaner look


hist(results_t_test_gpr$d)
```
# Combine effects correlational

```{r}
#combine correlational effects
results_corr_gpr$dimension <- rep(NA,nrow(results_corr_gpr))

results_corr <- rbind(results_corr_aspiration,results_corr_gpr)

results_corr <- results_corr %>% filter(!grepl("overall", IV)) #remove rows with correlations of overall scores (only needed for regression models)

#removing prefix 'mean_'
results_corr$DV <- sub("^mean_", "", results_corr$DV)
results_corr$IV <- sub("^mean_", "", results_corr$IV)


#imputing 'gpr' as dimension (next to chances and importance in the aspiration indices)
results_corr$dimension[is.na(results_corr$dimension)] <- "gpr"

#recomving prefix 'gpr_'
results_corr$IV <- sub("^gpr_", "", results_corr$IV)

#removing prefix 'asp_'
results_corr$IV <- sub("^asp_", "", results_corr$IV)

#make order more intuitive
results_corr <- results_corr %>%
  mutate(dimension = factor(dimension, levels = c("importance", "chances", "gpr"))) %>%
  mutate(DV = factor(DV, levels = c("self_actualization", "vitality","control_orientation","depressive_symptoms","trait_anxiety"))) %>%
  arrange(DV, dimension)

# Now, 'dimension' is ordered as per the specified levels, and the dataframe is sorted accordingly.

results_corr_plot_data <- results_corr

results_corr_plot_data$r <- as.numeric(results_corr_plot_data$r)
results_corr_plot_data$ci_low <- as.numeric(results_corr_plot_data$ci_low)
results_corr_plot_data$ci_high <- as.numeric(results_corr_plot_data$ci_high)

# Create a combined label for plotting
results_corr_plot_data$combined_label <- with(results_corr_plot_data, paste(DV, IV, sep = ": "))

# Convert the combined_label to a factor to maintain the original order
results_corr_plot_data$combined_label <- factor(results_corr_plot_data$combined_label, 
                                            levels = unique(results_corr_plot_data$combined_label))

results_corr_plot_data$text_label <- with(results_corr_plot_data, 
                                      paste0("", round(r, 2), 
                                             ", CI [", round(ci_low, 2), ", ", round(ci_high, 2), "]"))

# Create the forest plot with correct confidence intervals and add the text labels
ggplot(results_corr_plot_data, aes(x = r, y = combined_label,color = dimension)) +
  geom_point() +  # Plot the correlation coefficients as points
  geom_errorbarh(aes(xmin = ci_low, xmax = ci_high), height = 0.2) +  # Draw horizontal error bars for CIs
  geom_text(aes(label = text_label, x = 1.05 * max(ci_high)), hjust = 0, size = 3, nudge_x = 0.02, colour = "black") +
  facet_wrap(~dimension, scales = "free_y", ncol = 1) +  # Group by 'dimension'
  theme_minimal() +  # Use a minimal theme for a clean look
  labs(x = "Correlation Coefficient (r)", y = "") +  # Label the x-axis
  theme_classic()+
  xlim(-0.3,.40)+
  geom_vline(xintercept = 0, linetype = "dashed", color = "black")+
  theme(axis.text.y = element_text(size = rel(0.8)),  # Adjust y-axis text size
        legend.position = "none",  # Remove the legend
        strip.background = element_blank(),  # Remove facet label background for a cleaner look
        strip.text.y = element_text(size = rel(1.2)))  # Adjust facet label text size for readability

#ggsave("forest_plot_corr.pdf", width = 8, height = 10)
```

# Combine effect comparison
## t-tests
### aspiration importance

```{r}
#combine aspiration and guiding principle findings

results_ttest <- rbind(results_t_test_aspiration, results_t_test_gpr)

#removing prefix 'mean_'
results_ttest$Parameter <- sub("^mean_", "", results_ttest$Parameter)

#removing prefix 'comp_'
results_ttest$Group <- sub("^mean_", "", results_ttest$Group)

#recompute label
results_ttest$Label <- paste(results_ttest$Parameter, "-", results_ttest$Group)

#compute dimension variable
results_ttest <- results_ttest %>%
  mutate(dimension = case_when(
    grepl("i$", Label) ~ "importance",
    grepl("c$", Label) ~ "chances",
    grepl("[ey]$", Label) ~ "gpr",
    TRUE ~ NA_character_  # Handles cases that don't match any condition
  ))

#plotting

results_ttest_plot_data <- results_ttest

results_ttest_plot_data$text_label <- with(results_ttest_plot_data, 
                                      paste0("", round(d, 2), 
                                             ", CI [", round(d_CI_low, 2), ", ", round(d_CI_high, 2), "]"))

#ggsave("forest_plot_t_test.pdf", width = 8, height = 10)

##aspiration importance

plot_asp_imp <- subset(results_ttest_plot_data, dimension == "importance")

##### get coded effects and connect

#read in from German format
df_coded <- read.csv2(file = "data/cohens_d_ttests.csv", stringsAsFactors = FALSE)

#get relevant columns
df_coded <- df_coded %>%
  select(c(
    variable,
    study,
    es,
    ci.lo,
    ci.hi
  ))

#round numeric data
df_coded <- sapply(df_coded, function(x) if(is.numeric(x)) round(x, 3) else x)

df_coded <- as.data.frame(df_coded)
df_coded$es <- as.numeric(df_coded$es)
df_coded$ci.lo <- as.numeric(df_coded$ci.lo)
df_coded$ci.hi <- as.numeric(df_coded$ci.hi)


#struggle with naming to align with current data
df_coded <- df_coded %>%
  mutate(parameter = case_when(
    grepl("_SA$", variable) ~ "self_actualization",
    grepl("_VI$", variable) ~ "vitality",
    grepl("_CO$", variable) ~ "control_orientation",
    grepl("_DP$", variable) ~ "depressive_symptoms",
    grepl("_AN$", variable) ~ "trait_anxiety",
    TRUE ~ NA_character_ # default case if none of the above conditions are met
  ))

#exclude chances (aspiration)
df_coded <- df_coded %>%
  filter(!grepl("^..C", variable)) 

#exclude guiding principles
df_coded <- df_coded %>%
  filter(!grepl("^.._", variable)) 

#delete last three letters from variable and make rest to lower case and make some further adjustments
df_coded <- df_coded %>%
  mutate(variable = tolower(substr(variable, 1, nchar(variable) - 3)))

df_coded <- df_coded %>%
  mutate(variable = paste0("comp_fsi_", tolower(variable)))

df_coded$Label <- paste(df_coded$parameter, "-", df_coded$variable)

df_coded$text_label <- with(df_coded, paste0("", round(es, 2), 
                                             ", CI [", round(ci.lo, 2), ", ", round(ci.hi, 2), "]"))

#select relevant columns from present data
plot_asp_imp <- plot_asp_imp %>%
  select(c(
    Group,
    d,
    d_CI_low,
    d_CI_high,
    Parameter,
    Label,
    text_label
  ))

#introduce index
plot_asp_imp$study <- rep(3,nrow(plot_asp_imp))

#put at correct position
plot_asp_imp <- plot_asp_imp %>%
  select(1, study, everything())

#unify names
names(plot_asp_imp) <- names(df_coded)

#combine data of all three studies
df_asp_imp_all <- rbind(df_coded,plot_asp_imp)
df_asp_imp_all$study <- as.numeric(df_asp_imp_all$study)

df_asp_imp_all <- df_asp_imp_all %>% arrange(Label, study)

#plotting

# Step 1: Data Preparation
df_asp_imp_all <- df_asp_imp_all %>%
  mutate(
    study = as.factor(study), # Ensure 'study' is a factor
    # Create a unique label for each combination of Label and Study for plotting
    unique_label = interaction(Label, study, sep = " - "),
    # Arrange for plotting order, if necessary
    plot_order = as.numeric(factor(unique_label, levels = unique(unique_label)))
  ) %>%
  arrange(Label, study)

#make label more readable
df_asp_imp_all$unique_label <- gsub(" - comp_fsi_", ": ", df_asp_imp_all$unique_label)
df_asp_imp_all$unique_label <- gsub("_", " ", df_asp_imp_all$unique_label)
df_asp_imp_all$unique_label <- gsub("control orientation", "cont. orient.", df_asp_imp_all$unique_label)
df_asp_imp_all$unique_label <- gsub("depressive symptoms", "depr. symp.", df_asp_imp_all$unique_label)
df_asp_imp_all$unique_label <- gsub("actualization", "act.", df_asp_imp_all$unique_label)
df_asp_imp_all$unique_label <- gsub("anxiety", "anx.", df_asp_imp_all$unique_label)

#make data more readable
df_asp_imp_all$text_label <- gsub("0,", "0.00", df_asp_imp_all$text_label)
df_asp_imp_all$text_label <- gsub(", CI", "", df_asp_imp_all$text_label)
df_asp_imp_all$text_label <- gsub(" CI", "", df_asp_imp_all$text_label)

#define lower bound of x-axis flexibly
xlim_lo <- 1.05*min(df_asp_imp_all$ci.lo)

# Step 2: Plotting
ggplot(df_asp_imp_all, aes(x = es, y = reorder(unique_label, desc(plot_order)), color = study)) +
  geom_point() + # Plot the effect sizes as points
  geom_errorbarh(aes(xmin = ci.lo, xmax = ci.hi), height = 0.2) + # Add error bars for confidence intervals
  scale_color_viridis_d(begin = 0.2, end = 0.8, name = "Study", guide = guide_legend(override.aes = list(size=4))) +
    labs(x = "", y = "") +
  theme_classic() +
  theme(
    legend.position = "bottom",
    axis.text.y = element_text(size = 12),
    legend.text = element_text(size = 12),
    legend.title = element_text(size = 12),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_text(color = "black")
  )+geom_vline(xintercept = 0)+
  geom_hline(yintercept = c(3.5,6.5,9.5,11.5,13.5,15.5,
                            18.5,21.5,24.5,26.5,28.5,30.5,
                            32.5,34.5), linetype = 2)+
  geom_text(aes(label = text_label, x = 1.05 * max(ci.hi)), hjust = 0, size = 4.5, nudge_x = 0.02, colour = "black")+
  xlim(xlim_lo,2)

#ggsave("forest_plot_t_test_importance.pdf", width = 8, height = 10)
#ggsave("forest_plot_t_test_importance.png", width = 7, height = 10)
```

### aspiration chances

```{r}
plot_asp_cha <- subset(results_ttest_plot_data, dimension == "chances")

##### get coded effects and connect

#read in from German format
df_coded <- read.csv2(file = "data/cohens_d_ttests.csv", stringsAsFactors = FALSE)

#get relevant columns
df_coded <- df_coded %>%
  select(c(
    variable,
    study,
    es,
    ci.lo,
    ci.hi
  ))

#round numeric data
df_coded <- sapply(df_coded, function(x) if(is.numeric(x)) round(x, 3) else x)

df_coded <- as.data.frame(df_coded)
df_coded$es <- as.numeric(df_coded$es)
df_coded$ci.lo <- as.numeric(df_coded$ci.lo)
df_coded$ci.hi <- as.numeric(df_coded$ci.hi)


#struggle with naming to align with current data
df_coded <- df_coded %>%
  mutate(parameter = case_when(
    grepl("_SA$", variable) ~ "self_actualization",
    grepl("_VI$", variable) ~ "vitality",
    grepl("_CO$", variable) ~ "control_orientation",
    grepl("_DP$", variable) ~ "depressive_symptoms",
    grepl("_AN$", variable) ~ "trait_anxiety",
    TRUE ~ NA_character_ # default case if none of the above conditions are met
  ))

#exclude importance (aspiration)
df_coded <- df_coded %>%
  filter(!grepl("^..I", variable)) 

#exclude guiding principles
df_coded <- df_coded %>%
  filter(!grepl("^.._", variable)) 

#delete last three letters from variable and make rest to lower case and make some further adjustments
df_coded <- df_coded %>%
  mutate(variable = tolower(substr(variable, 1, nchar(variable) - 3)))

df_coded <- df_coded %>%
  mutate(variable = paste0("comp_fsc_", tolower(variable)))

df_coded$Label <- paste(df_coded$parameter, "-", df_coded$variable)

df_coded$text_label <- with(df_coded, paste0("", round(es, 2), 
                                             ", CI [", round(ci.lo, 2), ", ", round(ci.hi, 2), "]"))

#select relevant columns from present data
plot_asp_cha <- plot_asp_cha %>%
  select(c(
    Group,
    d,
    d_CI_low,
    d_CI_high,
    Parameter,
    Label,
    text_label
  ))

#introduce index
plot_asp_cha$study <- rep(3,nrow(plot_asp_cha))

#put at correct position
plot_asp_cha <- plot_asp_cha %>%
  select(1, study, everything())

#unify names
names(plot_asp_cha) <- names(df_coded)

#combine data of all three studies
df_asp_cha_all <- rbind(df_coded,plot_asp_cha)
df_asp_cha_all$study <- as.numeric(df_asp_cha_all$study)

df_asp_cha_all <- df_asp_cha_all %>% arrange(Label, study)

#plotting

# Step 1: Data Preparation
df_asp_cha_all <- df_asp_cha_all %>%
  mutate(
    study = as.factor(study), # Ensure 'study' is a factor
    # Create a unique label for each combination of Label and Study for plotting
    unique_label = interaction(Label, study, sep = " - "),
    # Arrange for plotting order, if necessary
    plot_order = as.numeric(factor(unique_label, levels = unique(unique_label)))
  ) %>%
  arrange(Label, study)

#make label more readable
df_asp_cha_all$unique_label <- gsub(" - comp_fsc_", ": ", df_asp_cha_all$unique_label)
df_asp_cha_all$unique_label <- gsub("_", " ", df_asp_cha_all$unique_label)
df_asp_cha_all$unique_label <- gsub("control orientation", "cont. orient.", df_asp_cha_all$unique_label)
df_asp_cha_all$unique_label <- gsub("depressive symptoms", "depr. symp.", df_asp_cha_all$unique_label)
df_asp_cha_all$unique_label <- gsub("actualization", "act.", df_asp_cha_all$unique_label)
df_asp_cha_all$unique_label <- gsub("anxiety", "anx.", df_asp_cha_all$unique_label)

#make data more readable
df_asp_cha_all$text_label <- gsub("0,", "0.00", df_asp_cha_all$text_label)
df_asp_cha_all$text_label <- gsub(", CI", "", df_asp_cha_all$text_label)
df_asp_cha_all$text_label <- gsub(" CI", "", df_asp_cha_all$text_label)

#define lower bound of x-axis flexibly
xlim_lo <- 1.05*min(df_asp_cha_all$ci.lo)

# Step 2: Plotting
ggplot(df_asp_cha_all, aes(x = es, y = reorder(unique_label, desc(plot_order)), color = study)) +
  geom_point() + # Plot the effect sizes as points
  geom_errorbarh(aes(xmin = ci.lo, xmax = ci.hi), height = 0.2) + # Add error bars for confidence intervals
  scale_color_viridis_d(begin = 0.2, end = 0.8, name = "Study", guide = guide_legend(override.aes = list(size=4))) +
    labs(x = "", y = "") +
  theme_classic() +
  theme(
    legend.position = "bottom",
    axis.text.y = element_text(size = 12),
    legend.text = element_text(size = 12),
    legend.title = element_text(size = 12),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_text(color = "black")
  )+geom_vline(xintercept = 0)+
  geom_hline(yintercept = c(3.5,6.5,9.5,11.5,13.5,15.5,
                            18.5,21.5,24.5,26.5,28.5,30.5,
                            32.5,34.5), linetype = 2)+
  geom_text(aes(label = text_label, x = 1.05 * max(ci.hi)), hjust = 0, size = 4.5, nudge_x = 0.02, colour = "black")+
  xlim(xlim_lo,2)

#ggsave("forest_plot_t_test_chances.pdf", width = 8, height = 10)
#ggsave("forest_plot_t_test_chances.png", width = 7, height = 10)
```

### guiding principles

```{r}
plot_asp_gp <- subset(results_ttest_plot_data, dimension == "gpr")

##### get coded effects and connect

#read in from German format
df_coded <- read.csv2(file = "data/cohens_d_ttests.csv", stringsAsFactors = FALSE)

#get relevant columns
df_coded <- df_coded %>%
  select(c(
    variable,
    study,
    es,
    ci.lo,
    ci.hi
  ))

#round numeric data
df_coded <- sapply(df_coded, function(x) if(is.numeric(x)) round(x, 3) else x)

df_coded <- as.data.frame(df_coded)
df_coded$es <- as.numeric(df_coded$es)
df_coded$ci.lo <- as.numeric(df_coded$ci.lo)
df_coded$ci.hi <- as.numeric(df_coded$ci.hi)


#struggle with naming to align with current data
df_coded <- df_coded %>%
  mutate(parameter = case_when(
    grepl("_SA$", variable) ~ "self_actualization",
    grepl("_VI$", variable) ~ "vitality",
    grepl("_CO$", variable) ~ "control_orientation",
    grepl("_DP$", variable) ~ "depressive_symptoms",
    grepl("_AN$", variable) ~ "trait_anxiety",
    TRUE ~ NA_character_ # default case if none of the above conditions are met
  ))

#exclude importance (aspiration)
df_coded <- df_coded %>%
  filter(!grepl("^..I", variable)) 

#exclude chances aspiration
df_coded <- df_coded %>%
  filter(!grepl("^..C", variable)) 

#delete last three letters from variable and make rest to lower case and make some further adjustments
df_coded <- df_coded %>%
  mutate(variable = tolower(substr(variable, 1, nchar(variable) - 3)))

df_coded$Label <- paste(df_coded$parameter, "-", df_coded$variable)

df_coded$text_label <- with(df_coded, paste0("", round(es, 2), 
                                             ", CI [", round(ci.lo, 2), ", ", round(ci.hi, 2), "]"))

#select relevant columns from present data
plot_asp_gp <- plot_asp_gp %>%
  select(c(
    Group,
    d,
    d_CI_low,
    d_CI_high,
    Parameter,
    Label,
    text_label
  ))

#introduce index
plot_asp_gp$study <- rep(3,nrow(plot_asp_gp))

#put at correct position
plot_asp_gp <- plot_asp_gp %>%
  select(1, study, everything())

#unify names
names(plot_asp_gp) <- names(df_coded)

#combine data of all three studies
df_asp_gp_all <- rbind(df_coded,plot_asp_gp)
df_asp_gp_all$study <- as.numeric(df_asp_gp_all$study)

#df_asp_gp_all <- df_asp_gp_all %>% arrange(Label, study)

#plotting

# Step 1: Data Preparation
df_asp_gp_all <- df_asp_gp_all %>%
  mutate(
    study = as.factor(study), # Ensure 'study' is a factor
    # Create a unique label for each combination of Label and Study for plotting
    unique_label = interaction(Label, study, sep = " - ")) %>%
  arrange(Label, study)

#make label more readable
df_asp_gp_all$unique_label <- gsub(" - comp_money_", ": ", df_asp_gp_all$unique_label)
df_asp_gp_all$unique_label <- gsub("_", " ", df_asp_gp_all$unique_label)
df_asp_gp_all$unique_label <- gsub("fa ", "family ", df_asp_gp_all$unique_label)
df_asp_gp_all$unique_label <- gsub("we ", "welfare ", df_asp_gp_all$unique_label)
df_asp_gp_all$unique_label <- gsub("ion -", "ion:", df_asp_gp_all$unique_label)
df_asp_gp_all$unique_label <- gsub("oms -", "oms:", df_asp_gp_all$unique_label)
df_asp_gp_all$unique_label <- gsub("ety -", "ety:", df_asp_gp_all$unique_label)
df_asp_gp_all$unique_label <- gsub("ity -", "ity:", df_asp_gp_all$unique_label)
df_asp_gp_all$unique_label <- gsub("control orientation", "cont. orient.", df_asp_gp_all$unique_label)
df_asp_gp_all$unique_label <- gsub("depressive symptoms", "depr. symp.", df_asp_gp_all$unique_label)
df_asp_gp_all$unique_label <- gsub("actualization", "act.", df_asp_gp_all$unique_label)
df_asp_gp_all$unique_label <- gsub("anxiety", "anx.", df_asp_gp_all$unique_label)

df_asp_gp_all <- df_asp_gp_all %>%
  arrange(unique_label, study)

df_asp_gp_all$plot_order <- seq(1:nrow(df_asp_gp_all))

#make data more readable
df_asp_gp_all$text_label <- gsub("0,", "0.00", df_asp_gp_all$text_label)
df_asp_gp_all$text_label <- gsub(", CI", "", df_asp_gp_all$text_label)
df_asp_gp_all$text_label <- gsub(" CI", "", df_asp_gp_all$text_label)

#define lower bound of x-axis flexibly
xlim_lo <- 1.05*min(df_asp_gp_all$ci.lo)

# Step 2: Plotting
ggplot(df_asp_gp_all, aes(x = es, y = reorder(unique_label, desc(plot_order)), color = study)) +
  geom_point() + # Plot the effect sizes as points
  geom_errorbarh(aes(xmin = ci.lo, xmax = ci.hi), height = 0.2) + # Add error bars for confidence intervals
  scale_color_viridis_d(begin = 0.2, end = 0.8, name = "Study", guide = guide_legend(override.aes = list(size=4))) +
    labs(x = "", y = "") +
  theme_classic() +
  theme(
    legend.position = "bottom",
    axis.text.y = element_text(size = 12),
    legend.text = element_text(size = 12),
    legend.title = element_text(size = 12),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_text(color = "black")
  )+geom_vline(xintercept = 0)+
  geom_hline(yintercept = c(6.5,10.5,16.5,20.5,24.5), linetype = 2)+
  geom_text(aes(label = text_label, x = 1.05 * max(ci.hi)), hjust = 0, size = 4.5, nudge_x = 0.02, colour = "black")+
  xlim(xlim_lo,2)

#ggsave("forest_plot_t_test_guiding.pdf", width = 8, height = 10)
#ggsave("forest_plot_t_test_guiding.png", width = 7, height = 7)
```

## correlations
### preparation
we did it here a bit more parsimonious than for the t-tests
```{r}
#combine aspiration and guiding principle findings

results_corr <- rbind(results_corr_aspiration, results_corr_gpr)

#removing prefix 'mean_'
results_corr$DV <- sub("^mean_", "", results_corr$DV)

#removing prefix 'comp_'
results_corr$IV <- sub("^mean_", "", results_corr$IV)

#recompute label
results_corr$Label <- paste(results_corr$DV, "-", results_corr$IV)

#compute dimension variable
results_corr <- results_corr %>%
  mutate(dimension = case_when(
    grepl("i$", Label) ~ "importance",
    grepl("c$", Label) ~ "chances",
    grepl("[ey]$", Label) ~ "gpr",
    TRUE ~ NA_character_  # Handles cases that don't match any condition
  ))

#remove overall scores
results_corr <- results_corr[!grepl("_overall", results_corr$IV), ]

#remove correlations of guiding principles with family and welfare (non-focal)
results_corr <- results_corr[!grepl("family", results_corr$Label), ]
results_corr <- results_corr[!grepl("welfare", results_corr$Label), ]

#make labels more readable
results_corr$Label <- gsub(" - asp_", ": ", results_corr$Label)
results_corr$Label <- gsub(" - gpr_", ": ", results_corr$Label)
results_corr$Label <- gsub(" global_", " ", results_corr$Label)
results_corr$Label <- gsub("_security", "", results_corr$Label)
results_corr$Label <- gsub("_", " ", results_corr$Label)

#text label for statistical information
results_corr$r <- as.numeric(results_corr$r)
results_corr$ci_low <- as.numeric(results_corr$ci_low)
results_corr$ci_high <- as.numeric(results_corr$ci_high)

results_corr$text_label <- with(results_corr, 
                                      paste0("", round(r, 2), 
                                             ", CI [", round(ci_low, 2), ", ", round(ci_high, 2), "]"))

#make text_label more readable
results_corr$text_label <- gsub("0,", "0.00", results_corr$text_label)
results_corr$text_label <- gsub(", CI", "", results_corr$text_label)
results_corr$text_label <- gsub(" CI", "", results_corr$text_label)

#create study variable

results_corr$study <- rep(3,nrow(results_corr))

##### get coded effects and connect

#read in from German format
df_coded <- read.csv2(file = "data/correlations_CI.csv", stringsAsFactors = FALSE)

#get relevant columns
df_coded <- df_coded %>%
  select(c(
    variable,
    study,
    cor,
    lwr.ci,
    upr.ci
  ))

#round numeric data
df_coded <- sapply(df_coded, function(x) if(is.numeric(x)) round(x, 3) else x)

df_coded <- as.data.frame(df_coded)
df_coded$cor <- as.numeric(df_coded$cor)
df_coded$lwr.ci <- as.numeric(df_coded$lwr.ci)
df_coded$upr.ci <- as.numeric(df_coded$upr.ci)


#struggle with naming to align with current data
df_coded <- df_coded %>%
  mutate(parameter = case_when(
    grepl("_SA$", variable) ~ "self_actualization",
    grepl("_VI$", variable) ~ "vitality",
    grepl("_CO$", variable) ~ "control_orientation",
    grepl("_DP$", variable) ~ "depressive_symptoms",
    grepl("_AN$", variable) ~ "trait_anxiety",
    TRUE ~ NA_character_ # default case if none of the above conditions are met
  ))

#delete last three letters from variable and make rest to lower case and make some further adjustments
df_coded <- df_coded %>%
  mutate(variable = tolower(substr(variable, 1, nchar(variable) - 3)))

df_coded$Label <- paste(df_coded$parameter, "-", df_coded$variable)

df_coded$text_label <- with(df_coded, paste0("", round(cor, 2), 
                                             ", CI [", round(lwr.ci, 2), ", ", round(upr.ci, 2), "]"))

df_coded$Label <- gsub(" -", ":", df_coded$Label)
df_coded$Label <- gsub("_", " ", df_coded$Label)

#compute dimension variable
df_coded <- df_coded %>%
  mutate(dimension = case_when(
    grepl("i$", variable) ~ "importance",
    grepl("c$", variable) ~ "chances",
    grepl("y$", variable) ~ "gpr",
    TRUE ~ NA_character_  # Handles cases that don't match any condition
  ))

#reduce each to needed variables

results_corr <- results_corr %>%
  select(c(
    study,
    dimension,
    Label,
    text_label,
    r,
    ci_low,
    ci_high
  ))

df_coded <- df_coded %>%
  select(c(
    study,
    dimension,
    Label,
    text_label,
    cor,
    lwr.ci,
    upr.ci
  ))

#unify names
names(df_coded) <- names(results_corr)

#combine data
results_corr <- rbind(results_corr,df_coded)
results_corr$study <- as.numeric(results_corr$study) #make study numeric

#create unique label
results_corr <- results_corr %>%
  mutate(
    study = as.factor(study), # Ensure 'study' is a factor
    # Create a unique label for each combination of Label and Study for plotting
    unique_label = interaction(Label, study, sep = " - ")) %>%
  arrange(Label, study)

results_corr$unique_label <- gsub("control orientation", "cont. orient.", results_corr$unique_label)
results_corr$unique_label <- gsub("depressive symptoms", "depr. symp.", results_corr$unique_label)
results_corr$unique_label <- gsub("actualization", "act.", results_corr$unique_label)
results_corr$unique_label <- gsub("anxiety", "anx.", results_corr$unique_label)

```

### importance

```{r}
corr_importance <- subset(results_corr, dimension == "importance")

corr_importance$plot_order <- seq(1:nrow(corr_importance))

corr_importance$study <- as.factor(corr_importance$study)

#define lower bound of x-axis flexibly
xlim_lo <- 1.05*min(corr_importance$ci_lo)
xlim_hi <- 2.5*max(corr_importance$ci_high)

# Step 2: Plotting
ggplot(corr_importance, aes(x = r, y = reorder(unique_label, desc(plot_order)), color = study)) +
  geom_point() + # Plot the effect sizes as points
  geom_errorbarh(aes(xmin = ci_low, xmax = ci_high), height = 0.2) + # Add error bars for confidence intervals
  scale_color_viridis_d(begin = 0.2, end = 0.8, name = "Study", guide = guide_legend(override.aes = list(size=4))) +
    labs(x = "", y = "") +
  theme_classic() +
  theme(
    legend.position = "bottom",
    axis.text.y = element_text(size = 12),
    legend.text = element_text(size = 12),
    legend.title = element_text(size = 12),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_text(color = "black")
  )+geom_vline(xintercept = 0)+
  geom_hline(yintercept = c(3.5,6.5,9.5,12.5,
                            14.5,16.5,18.5,20.5,
                            23.5,26.5,29.5,32.5,
                            34.5,36.5,38.5,40.5,44.5), linetype = 2)+
  geom_text(aes(label = text_label, x = 1.05 * max(ci_high)), hjust = 0, size = 4.5, nudge_x = 0.02, colour = "black")+
  xlim(xlim_lo,xlim_hi)

#ggsave("forest_plot_corr_importance.pdf", width = 8, height = 10)
#ggsave("forest_plot_corr_importance.png", width = 7, height = 10)

```

### chances

```{r}
corr_chance <- subset(results_corr, dimension == "chances")

corr_chance$plot_order <- seq(1:nrow(corr_chance))

corr_chance$study <- as.factor(corr_chance$study)

#define lower bound of x-axis flexibly
xlim_lo <- 1.05*min(corr_chance$ci_lo)
xlim_hi <- 2.2*max(corr_chance$ci_high)

max(corr_chance$ci_high)

# Step 2: Plotting
ggplot(corr_chance, aes(x = r, y = reorder(unique_label, desc(plot_order)), color = study)) +
  geom_point() + # Plot the effect sizes as points
  geom_errorbarh(aes(xmin = ci_low, xmax = ci_high), height = 0.2) + # Add error bars for confidence intervals
  scale_color_viridis_d(begin = 0.2, end = 0.8, name = "Study", guide = guide_legend(override.aes = list(size=4))) +
    labs(x = "", y = "") +
  theme_classic() +
  theme(
    legend.position = "bottom",
    axis.text.y = element_text(size = 12),
    legend.text = element_text(size = 12),
    legend.title = element_text(size = 12),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_text(color = "black")
  )+geom_vline(xintercept = 0)+
  geom_hline(yintercept = c(3.5,6.5,9.5,12.5,
                            14.5,16.5,18.5,20.5,
                            23.5,26.5,29.5,32.5,
                            34.5,36.5,38.5,40.5,44.5), linetype = 2)+
  geom_text(aes(label = text_label, x = 1.05 * max(ci_high)), hjust = 0, size = 4.5, nudge_x = 0.02, colour = "black")+
  xlim(xlim_lo,xlim_hi)

#ggsave("forest_plot_corr_chance.pdf", width = 8, height = 10)
#ggsave("forest_plot_corr_chance.png", width = 7, height = 10)
```

### guiding principles

```{r}
corr_gpr <- subset(results_corr, dimension == "gpr")

corr_gpr$plot_order <- seq(1:nrow(corr_gpr))

corr_gpr$study <- as.factor(corr_gpr$study)

#define lower bound of x-axis flexibly
xlim_lo <- 1.05*min(corr_gpr$ci_lo)
xlim_hi <- 2.2*max(corr_gpr$ci_high)

max(corr_gpr$ci_high)

# Step 2: Plotting
ggplot(corr_gpr, aes(x = r, y = reorder(unique_label, desc(plot_order)), color = study)) +
  geom_point() + # Plot the effect sizes as points
  geom_errorbarh(aes(xmin = ci_low, xmax = ci_high), height = 0.2) + # Add error bars for confidence intervals
  scale_color_viridis_d(begin = 0.2, end = 0.8, name = "Study", guide = guide_legend(override.aes = list(size=4))) +
    labs(x = "", y = "") +
  theme_classic() +
  theme(
    legend.position = "bottom",
    axis.text.y = element_text(size = 12),
    legend.text = element_text(size = 12),
    legend.title = element_text(size = 12),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_text(color = "black")
  )+geom_vline(xintercept = 0)+
  geom_hline(yintercept = c(3.5,5.5,7.5,9.5,11.5), linetype = 2)+
  geom_text(aes(label = text_label, x = 1.05 * max(ci_high)), hjust = 0, size = 4.5, nudge_x = 0.02, colour = "black")+
  xlim(xlim_lo,xlim_hi)

#ggsave("forest_plot_corr_gpr.pdf", width = 8, height = 10)
#ggsave("forest_plot_corr_gpr.png", width = 8, height = 4)
```

```{r}
#combine t-test df again for summary effect
df_ttest <- rbind(results_t_test_aspiration,results_t_test_gpr)
df_ttest$ES_id <- seq(1:nrow(df_ttest))
df_ttest$n <- nrow(df)
nrow(df$ == "1")  ## ==>> returns NULL

#prepare correlation results for summary effect
df_corr <- subset(results_corr, study == 3)
df_corr$n <- nrow(df)
df_corr$ES_id <- seq(1:nrow(df_corr))
```

# Overall Effect analysis for new Study
All following calculations are conducted using the metafor package.

## Summary effect T-test's

For final data preparation we use the abs function to turn all effects into the same (positive) direction, as to make the effects compareable.

We then add a running id to each collumn.

```{r}
#---- summary effect t tests ---- 
df_ttest$es <- abs(df_ttest$d) #using absolute to turn all effects positive, add subset for absolute to only flip variables which need it.

cohen_d_with_stats <- function(Mean_Group1, Mean_Group2, SD_Group_1, SD_Group_2, n1, n2) {
  pooled_sd <- sqrt(((n1 - 1) * SD_Group_1^2 + (n2 - 1) * SD_Group_2^2) / (n1 + n2 - 2))
  d_d <- (Mean_Group1 - Mean_Group2) / pooled_sd
  var_d <- (n1 + n2) / (n1 * n2) + (d_d^2 / (2 * (n1 + n2 - 2)))
  se_d <- sqrt(var_d)
  ci_95_low <- d_d - 1.96 * se_d
  ci_95_high <- d_d + 1.96 * se_d
  return(c(d_d, var_d, se_d, ci_95_low, ci_95_high))
}

# Apply the function to each row
results_var_d <- apply(df_ttest, 1, function(x) cohen_d_with_stats(as.numeric(x['Mean_Group_1']), 
                                                       as.numeric(x['Mean_Group_2']), 
                                                       as.numeric(x['SD_Group1']), 
                                                       as.numeric(x['SD_Group2']), 
                                                       as.numeric(x['n'])))

# Converting results to a dataframe
results_var_d <- as.data.frame(t(results_var_d))

df_ttest$var <- results_var_d$var_d
  
  
```

Following this we use a Meta-Analysis via Multivariate/Multilevel Linear (Mixed-Effects) Models to calculate a model for the overall effect. Which we then look into using the summary function.

```{r}
overall.ma4<-rma.mv(yi=d,
                    V=var_d,
                    #random=list(~1|study/es.id),
                    tdist=TRUE,
                    method="REML",
                    slab=study,
                    data=df_ttest)	

summary(overall.ma4)
```


## Summary effect correlation's

For final data preparation we use the abs function to turn all effects into the same (positive) direction, as to make the effects comparable.

We then add a running id to each column.

```{r}
#---- summary effect cor ----

df$corr <- abs(df$corr) #using absolute to turn all effects positive, add subset for absolute to only flip variables which need it.
```

For the analysis using the correlation data we need to add a variable containing the Variance of the correlation to do this we use the escalc function of the metafor package. Which uses the correlations and sample size to determine the variance which will then be added back into the dataset.

```{r}
x <- escalc(measure="COR", ri=df_corr$r, ni=df_corr$n) #calc variance of correlations
df_corr$var <- x$vi
```

Following this we use a Meta-Analysis via Multivariate/Multilevel Linear (Mixed-Effects) Models to calculate a model for the overall effect. Which we then look into using the summary function.

```{r}
overall.ma5<-rma.mv(yi=r,
                    V=var,
                    #random=list(~1|study/ES_id),
                    tdist=TRUE,
                    method="REML",
                    slab=study,
                    data=df_corr)	

summary(overall.ma5)

```







