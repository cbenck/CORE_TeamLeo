---
title: "Kasser_Ryan_1993"
author: "Leopold Roth"
date: "2023-11-24"
output: 
  html_document:
    toc: true
    toc_depth: 4
---

# Packages
```{r}
# R version: 4.3.1
library(dplyr) # 1.1.2
library(readr) # 2.1.4
library(readxl) # 1.4.2
library(haven) # 2.5.2
library(misty) # 0.5.4
library(tidyr) # 1.3.0
library(ggplot2) # 3.4.4
library(sjPlot) # 2.8.14
library(broom) # 1.0.5
```

# Load Data
```{r}
#this chunk loads the dataset, strores it in the object 'df' and reassures that it is a dataframe
df <- read_sav("data/[PCIRR] Kasser and Ryan (1993) replication CR_1993 [Team Leo]_NOCHECKS_December 14, 2023_07.52.sav")
df <- as.data.frame(df)
#N initial:
```

# Check data
## exclude incomplete cases
```{r}
#this subsets the data to only keep cases who completed the entire survey
df<-subset(df, as.numeric(Progress) == 100)
#N complete:
```

## exclude by conduction time (3SD faster than average)
```{r}
#this serves the purpose to exclude cases in which people/bots clicked through everything as fast as possible
df$Duration__in_seconds_<-as.numeric(df$Duration__in_seconds_)
sd_duration<-(sd(df$Duration__in_seconds_)*3) #compute 3 times SD of duration
mean_duration<-mean(df$Duration__in_seconds_) #compute mean duration
cut_duration<-mean_duration-sd_duration #minimum time cut-off = mean time - three SD
df<-subset(df,df$Duration__in_seconds_>=cut_duration) #filter out cases with shorter usage
#N after time exclusion:
```

## exclude by missed attention checks (3 attention checks) (deactivated in simulation)
```{r}
#the survey included 3 attention checks; incorrectly responding to one of these will lead to exclusion from the final dataset
#df<-subset(df, AT_1 == 5)
#df<-subset(df, AT_2 == 1)
#df<-subset(df, AT_3 == 3)

#N after attention exclusion (final N):
```

# Clean data
## exclude columns of attention checks
```{r}
#after the exclusion, we exclude the attention check columns from the dataset
df <- df %>% select(-c("AT_1", "AT_2", "AT_3"))
```

## TODOexclude non-needed columns
```{r}
#this will be updated, in case qualtrics attaches columns, which are not needed for the analysis
```
## recode variables
```{r}
#this chunk recodes variables which were reverse coded. These were marked with _R in the variable name
#as the different scales operate on different scale widths, we need to select the reversed items by scale, using the starting letters or the variables (e.g., SA for the self-actualization items)
#the code then 'takes' all variables, starting with 'SA' and ending with '_R' and recodes them, based on the specific scale (1 to 4 or 1 to 7 etc.)
#self-actualization
df <- df %>%
  mutate(across(grep("^SA_.*_R$", names(df), value = TRUE), ~case_when(
    . == 1 ~ 4,
    . == 2 ~ 3,
    . == 3 ~ 2,
    . == 4 ~ 1,
    TRUE ~ . # keeps original value if none of the above conditions are met
  )))

#vitality
df <- df %>%
  mutate(across(grep("^VI_.*_R$", names(df), value = TRUE), ~case_when(
    . == 1 ~ 7,
    . == 2 ~ 6,
    . == 3 ~ 5,
    . == 4 ~ 4,
    . == 5 ~ 3,
    . == 6 ~ 2,
    . == 7 ~ 1,
    TRUE ~ . # keeps original value if none of the above conditions are met
  )))

#depressive symptoms
df <- df %>%
  mutate(across(grep("CES_.*_R$", names(df), value = TRUE), ~case_when(
    . == 0 ~ 3,
    . == 1 ~ 2,
    . == 2 ~ 1,
    . == 3 ~ 0,
    TRUE ~ . # keeps original value if none of the above conditions are met
  )))

#trait anxiety
df <- df %>%
  mutate(across(grep("AN_.*_R$", names(df), value = TRUE), ~case_when(
    . == 4 ~ 1,
    . == 3 ~ 2,
    . == 2 ~ 3,
    . == 1 ~ 4,
    TRUE ~ . # keeps original value if none of the above conditions are met
  )))
```


## rename variables (remove _R from recode variables)
```{r}
#after recoding the variables (see chunk above), the marking of the reversed variables is no longer needed
#hence, the '_R' is removed from the variables names

#self-actualization
names(df) <- ifelse(grepl("^SA_", names(df)), gsub("_R$", "", names(df)), names(df))
#vitality
names(df) <- ifelse(grepl("^VI_", names(df)), gsub("_R$", "", names(df)), names(df))
#depressive symptoms
names(df) <- ifelse(grepl("^CES_", names(df)), gsub("_R$", "", names(df)), names(df))
#trait anxiety
names(df) <- ifelse(grepl("^AN_", names(df)), gsub("_R$", "", names(df)), names(df))


```

# Descriptives
## compute reliabilities
```{r}
#this chunk computes the reliabilities (cronbachs alpha) for all measures of interest in the study. By keeping the [[1]] in every line, only the alpha is reported
#to get more details on the item level, delete the [[1]]

###independent variables
#Aspiration index: importance
psych::alpha(df%>% select(starts_with("ASP_SAI")))[[1]]
psych::alpha(df%>% select(starts_with("ASP_AFI")))[[1]]
psych::alpha(df%>% select(starts_with("ASP_CFI")))[[1]]
psych::alpha(df%>% select(starts_with("ASP_FSI")))[[1]]

#Aspiration index: chances
psych::alpha(df%>% select(starts_with("ASP_SAC")))[[1]]
psych::alpha(df%>% select(starts_with("ASP_AFC")))[[1]]
psych::alpha(df%>% select(starts_with("ASP_CFC")))[[1]]
psych::alpha(df%>% select(starts_with("ASP_FSC")))[[1]]

#Guiding principles:
## money
psych::alpha(df%>%select(grep("^GPR_.*_1$", names(df), value = TRUE)))[[1]]
##family security
psych::alpha(df%>%select(grep("^GPR_.*_2$", names(df), value = TRUE)))[[1]]
##global welfare
psych::alpha(df%>%select(grep("^GPR_.*_3$", names(df), value = TRUE)))[[1]]
##spirituality
psych::alpha(df%>%select(grep("^GPR_.*_4$", names(df), value = TRUE)))[[1]]
##hedonism
psych::alpha(df%>%select(grep("^GPR_.*_5$", names(df), value = TRUE)))[[1]]

###dependent variables
#self-actualization
psych::alpha(df%>% select(starts_with("SA_")))[[1]]
#vitality
psych::alpha(df%>% select(starts_with("VI_")))[[1]]
#control orientation (only care about control-subscale)
psych::alpha(df%>%select(grep("^CO_.*_C$", names(df), value = TRUE)))[[1]]
#depressive symptoms
psych::alpha(df%>% select(starts_with("CES_")))[[1]]
#trait anxiety
psych::alpha(df%>% select(starts_with("AN_")))[[1]]
```

## demographics
```{r}
###describe age:
psych::describe(df$age)
ggplot(df,aes(y = age))+
  geom_boxplot()+
  theme_classic()

###describe best identified gender:
table(df$gender) #1 = male, 2 = female, 3 = other, 4 = rather not disclose


# Calculate the table and convert it to a data frame
gender_table <- table(df$gender)
gender_df <- data.frame(Category = names(gender_table), Count = as.integer(gender_table))

# Add a column for percentages
gender_df$Percentage <- (gender_df$Count / sum(gender_df$Count)) * 100

# Update Category names to be more descriptive
gender_df$Category <- factor(gender_df$Category, levels = c("1", "2", "3", "4"),
                             labels = c("Male", "Female", "Other", "Rather not disclose"))

# Plot
ggplot(gender_df, aes(x = Category, y = Percentage, fill = Category)) +
  geom_bar(stat = "identity") +
  scale_fill_brewer(palette = "Pastel1") + 
  labs(title = "Gender Distribution", x = "Gender", y = "Percentage (%)") +
  theme_classic() +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), vjust = -0.5)

```

## compute means
```{r}
#this chunk computes all needed means for the analysis
#first all independent variables, afterwards the dependent variables

###independent variables
#aspiration index: importances
df <- df %>% mutate(mean_asp_sai = rowMeans(select(., starts_with("ASP_SAI")), na.rm = TRUE))
df <- df %>% mutate(mean_asp_afi = rowMeans(select(., starts_with("ASP_AFI")), na.rm = TRUE))
df <- df %>% mutate(mean_asp_cfi = rowMeans(select(., starts_with("ASP_CFI")), na.rm = TRUE))
df <- df %>% mutate(mean_asp_fsi = rowMeans(select(., starts_with("ASP_FSI")), na.rm = TRUE))

#aspiration index: overall importance
df <- df %>%
  mutate(mean_asp_overall_importance = rowMeans(select(.,starts_with("ASP_SAI"),
                                                         starts_with("ASP_AFI"),
                                                         starts_with("ASP_CFI"),
                                                         starts_with("ASP_FSI")), 
                                                        na.rm = TRUE))
#aspiration index: chances
df <- df %>% mutate(mean_asp_sac = rowMeans(select(., starts_with("ASP_SAC")), na.rm = TRUE))
df <- df %>% mutate(mean_asp_afc = rowMeans(select(., starts_with("ASP_AFC")), na.rm = TRUE))
df <- df %>% mutate(mean_asp_cfc = rowMeans(select(., starts_with("ASP_CFC")), na.rm = TRUE))
df <- df %>% mutate(mean_asp_fsc = rowMeans(select(., starts_with("ASP_FSC")), na.rm = TRUE))

#aspiration index: overall chances
df <- df %>%
  mutate(mean_asp_overall_chances = rowMeans(select(.,starts_with("ASP_SAC"),
                                                         starts_with("ASP_AFC"),
                                                         starts_with("ASP_CFC"),
                                                         starts_with("ASP_FSC")), 
                                                        na.rm = TRUE))

#guiding principles: mean position in rank-ordering across three rankings
#money
df <- df %>% mutate(mean_gpr_money = 
                      rowMeans(select(., grep("^GPR_.*_1$", names(df), value = TRUE)), 
                      na.rm = TRUE))
#family security
df <- df %>% mutate(mean_gpr_family_security = 
                      rowMeans(select(., grep("^GPR_.*_2$", names(df), value = TRUE)), 
                      na.rm = TRUE))
#global welfare
df <- df %>% mutate(mean_gpr_global_welfare = 
                      rowMeans(select(., grep("^GPR_.*_3$", names(df), value = TRUE)), 
                      na.rm = TRUE))
#spirituality
df <- df %>% mutate(mean_gpr_spirituality = 
                      rowMeans(select(., grep("^GPR_.*_4$", names(df), value = TRUE)), 
                      na.rm = TRUE))
#hedonism
df <- df %>% mutate(mean_gpr_hedonism = 
                      rowMeans(select(., grep("^GPR_.*_5$", names(df), value = TRUE)), 
                      na.rm = TRUE))

###dependent variables
#self-actualization
df <- df %>% mutate(mean_self_actualization = 
                      rowMeans(select(., starts_with("SA_")), na.rm = TRUE))
#vitality
df <- df %>% mutate(mean_vitality = 
                      rowMeans(select(., starts_with("VI_")), na.rm = TRUE))
#control orientation
df <- df %>% mutate(mean_control_orientation = 
                      rowMeans(select(., grep("^CO_.*_C$", names(df), value = TRUE)), 
                      na.rm = TRUE))

#depressive symptoms
df <- df %>% mutate(mean_depressive_symptoms = 
                      rowMeans(select(., starts_with("CES_")), na.rm = TRUE))

#trait anxiety
df <- df %>% mutate(mean_trait_anxiety = 
                      rowMeans(select(., starts_with("AN_")), na.rm = TRUE))
```

## describe distribution of means
```{r}
#here we receive all relevant descriptive informations about the distribution properties of the means
#numerically describe all means
df_means <- df %>% select (starts_with("mean"))
df_means_describe <- psych::describe(df_means) #save descriptives in extra df: this contains detailed informations about all means (e.g., case number, Sd etc.)

#plot all means
long_df_means <- pivot_longer(df_means, cols = everything(), names_to = "variable", values_to = "value")

ggplot(long_df_means, aes(x = value)) +
  geom_histogram(bins = 30, fill = "blue", color = "black") +
  facet_wrap(~ variable, scales = "free_x") +
  theme_minimal() +
  labs(title = "Histograms of All Means", x = "Value", y = "Frequency")

```

## intercorrelations of means
```{r}
#here we create a correlation table between all means
df_means %>%
  correlation::correlation(p_adjust = "none")%>% #this disables any alpha corrections, but can be replace with other methods (https://rdrr.io/github/easystats/correlation/man/correlation.html)
  summary(redundant = TRUE) %>%
  plot()

df_means %>%
  correlation::correlation(p_adjust = "none")%>%
  filter(p < .05) #this is a subset with significant correlations at .05

df_means %>%
  correlation::correlation(p_adjust = "none")%>%
  filter(p < .001) #this is a subset with significant correlations at .001
  
```

# Analysis Kasser & Ryan (1993)
## Preliminary analysis
### MANOVA by gender with follow up t-tests & inter-corelations of importances and chances
```{r}
#exclude individuals which didn't indicate to identify as female/male
df_manova <- subset(df, gender < 3) 

#manova importances
manova_importances <- manova(cbind(mean_asp_sai,mean_asp_afi,mean_asp_cfi,mean_asp_fsi)
                             ~ gender, data = df_manova)
summary(manova_importances)
report::report(manova_importances)

#follow up t-tests
report::report(t.test(mean_asp_sai ~gender, data = df_manova))
report::report(t.test(mean_asp_afi ~gender, data = df_manova))
report::report(t.test(mean_asp_cfi ~gender, data = df_manova))
report::report(t.test(mean_asp_fsi ~gender, data = df_manova))

#manova chances
manova_chances <- manova(cbind(mean_asp_sac,mean_asp_afc,mean_asp_cfc,mean_asp_fsc)
                             ~ gender, data = df_manova)
summary(manova_chances)
report::report(manova_chances)

#follow up t-tests
report::report(t.test(mean_asp_sac ~gender, data = df_manova))
report::report(t.test(mean_asp_afc ~gender, data = df_manova))
report::report(t.test(mean_asp_cfc ~gender, data = df_manova))
report::report(t.test(mean_asp_fsc ~gender, data = df_manova))

#these correlations have been computed above with the other means already
#this section was create to give a more focal perspective on these correlations
#intercorrelate all importances
df_importance <- df_means %>% select(ends_with("i"))

df_importance %>%
  correlation::correlation(p_adjust = "none") %>%
  summary(redundant = TRUE) %>%
  plot()
  
#intercorrelate all chances
df_chance <- df_means %>% select(ends_with("c"))

df_chance %>%
  correlation::correlation(p_adjust = "none") %>%
  summary(redundant = TRUE) %>%
  plot()
```

### outcome by gender and aspiration interactions
```{r}
#this chunk runs all 40 proposed interction models by gender and aspirations
#the results are stored in 'df_results_gender_interactions'
#the significant ones are filtered and stored in a second dataframe called 'df_results_gender_interactions_sign'


extract_full_name <- function(string) {
    parts <- unlist(strsplit(string, "_"))
    # Assuming the dependent variable name is the first three parts of the split
    full_name <- paste(parts[1:3], collapse = "_")
    return(full_name)
}

run_models <- function(dependent_var, data) {
  models <- list()
  interactions_i <- c("mean_asp_sai", "mean_asp_afi", "mean_asp_cfi", "mean_asp_fsi")
  interactions_c <- c("mean_asp_sac", "mean_asp_afc", "mean_asp_cfc", "mean_asp_fsc")
  
  # Pair overall_importance with interactions ending in 'i'
  for (inter in interactions_i) {
    model_formula <- as.formula(paste(dependent_var, "~ mean_asp_overall_importance +", inter, "*gender"))
    model_name <- paste(dependent_var, "mean_asp_overall_importance", inter, sep="_")
    models[[model_name]] <- lm(model_formula, data = data)
  }

  # Pair overall_chances with interactions ending in 'c'
  for (inter in interactions_c) {
    model_formula <- as.formula(paste(dependent_var, "~ mean_asp_overall_chances +", inter, "*gender"))
    model_name <- paste(dependent_var, "mean_asp_overall_chances", inter, sep="_")
    models[[model_name]] <- lm(model_formula, data = data)
  }
  
  return(models)
}

dependent_vars <- c("mean_self_actualization","mean_vitality","mean_control_orientation", "mean_depressive_symptoms", "mean_trait_anxiety")
all_models <- list()

for (var in dependent_vars) {
  all_models[[var]] <- run_models(var, df)
}

model_summaries <- list()

for (var in names(all_models)) {
  model_summaries[[var]] <- lapply(all_models[[var]], broom::tidy)
}

results_df <- data.frame()

for (var in names(all_models)) {
    for (model_name in names(all_models[[var]])) {
        model_summary <- broom::tidy(all_models[[var]][[model_name]])
        model_summary$model <- model_name  # Add the model name directly here
        results_df <- rbind(results_df, model_summary)
    }
}

filtered_df <- results_df[grepl(":gender", results_df$term), ]

filtered_df$model <- sapply(filtered_df$model, extract_full_name)

df_results_gender_interactions <- filtered_df

#find significant interactions
df_results_gender_interactions_sign <- subset(df_results_gender_interactions, p.value < .05)
```

## Primary analysis

### define function to extract regression results

```{r}
extractModelStatistics <- function(model) {
  # Extract coefficients
  standardized_betas <- coef(model)
  
  # Extract confidence intervals
  standardized_cis <- confint(model, level = 0.95)
  standardized_cis <- setNames(as.data.frame(standardized_cis), c("Lower", "Upper"))
  rownames(standardized_cis) <- names(standardized_betas)
  
  # Extract p-values
  summary_model <- summary(model)
  p_values <- summary_model$coefficients[, "Pr(>|t|)"]
  
  # Create a data frame for coefficients and their names
  results <- data.frame(Estimate = standardized_betas, row.names = names(standardized_betas))
  
  # Add confidence intervals and p-values by matching row names
  results$Lower <- standardized_cis[rownames(results), "Lower"]
  results$Upper <- standardized_cis[rownames(results), "Upper"]
  results$P_Value <- p_values[rownames(results)]
  
  # Optionally drop rows with NA
  results <- na.omit(results)
  
  return(results)
}
```

### preparation for analysis
```{r}
#create standardized dataframe with means
df_means_scaled <- as.data.frame(scale(df_means))

#create names list which will be assigned often
names_corr <- c("DV", "IV", "r", "ci_low", "ci_high", "p")
names_regr <- c("beta", "ci_low", "ci_high", "p")
```


### regressions and correlations (DV by aspiration importance)
```{r}
#self-actualization - importance
df_SA_I <- df_means_scaled %>% select(c(mean_self_actualization, #create specific df for analysis
                                      mean_asp_overall_importance,
                                      mean_asp_sai,
                                      mean_asp_afi,
                                      mean_asp_fsi,
                                      mean_asp_cfi))

m1 <- lm(mean_self_actualization ~.,data = df_SA_I) #compute model

results_SA_I <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_SA_I) <- names_regr #rename dataframe with extracted results
results_SA_I$DV <- rep("SA",nrow(results_SA_I))

#get correlations

correlation_SA_I <- df_SA_I %>%
  correlation::correlation(p_adjust = "none")

correlation_SA_I  <- correlation_SA_I [1:5,]
correlation_SA_I <- as.data.frame(cbind(correlation_SA_I$Parameter1,
                                      correlation_SA_I$Parameter2,
                                      round(correlation_SA_I$r,3),
                                      round(correlation_SA_I$CI_low,3),
                                      round(correlation_SA_I$CI_high,3),
                                      round(correlation_SA_I$p,3)))

names(correlation_SA_I) <- names_corr


#vitality - importance
df_VI_I <- df_means_scaled %>% select(c(mean_vitality, #create specific df for analysis
                                      mean_asp_overall_importance,
                                      mean_asp_sai,
                                      mean_asp_afi,
                                      mean_asp_fsi,
                                      mean_asp_cfi))

m1 <- lm(mean_vitality ~.,data = df_VI_I) #compute model

results_VI_I <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_VI_I) <- names_regr #rename dataframe with extracted results
results_VI_I$DV <- rep("VI",nrow(results_VI_I))

#get correlations

correlation_VI_I <- df_VI_I %>%
  correlation::correlation(p_adjust = "none")

correlation_VI_I  <- correlation_VI_I [1:5,]
correlation_VI_I <- as.data.frame(cbind(correlation_VI_I$Parameter1,
                                      correlation_VI_I$Parameter2,
                                      round(correlation_VI_I$r,3),
                                      round(correlation_VI_I$CI_low,3),
                                      round(correlation_VI_I$CI_high,3),
                                      round(correlation_VI_I$p,3)))

names(correlation_VI_I) <- names_corr

#control orientation - importance
df_CO_I <- df_means_scaled %>% select(c(mean_control_orientation, #create specific df for analysis
                                      mean_asp_overall_importance,
                                      mean_asp_sai,
                                      mean_asp_afi,
                                      mean_asp_fsi,
                                      mean_asp_cfi))

m1 <- lm(mean_control_orientation ~.,data = df_CO_I) #compute model

results_CO_I <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_CO_I) <- names_regr #rename dataframe with extracted results
results_CO_I$DV <- rep("CO",nrow(results_CO_I))

#get correlations
correlation_CO_I <- df_CO_I %>%
  correlation::correlation(p_adjust = "none")

correlation_CO_I  <- correlation_CO_I [1:5,]
correlation_CO_I <- as.data.frame(cbind(correlation_CO_I$Parameter1,
                                      correlation_CO_I$Parameter2,
                                      round(correlation_CO_I$r,3),
                                      round(correlation_CO_I$CI_low,3),
                                      round(correlation_CO_I$CI_high,3),
                                      round(correlation_CO_I$p,3)))

names(correlation_CO_I) <- names_corr

#depressive symptoms - importance
df_DS_I <- df_means_scaled %>% select(c(mean_depressive_symptoms, #create specific df for analysis
                                      mean_asp_overall_importance,
                                      mean_asp_sai,
                                      mean_asp_afi,
                                      mean_asp_fsi,
                                      mean_asp_cfi))

m1 <- lm(mean_depressive_symptoms ~.,data = df_DS_I) #compute model

results_DS_I <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_DS_I) <- names_regr #rename dataframe with extracted results
results_DS_I$DV <- rep("DS",nrow(results_DS_I))

#get correlations
correlation_DS_I <- df_DS_I %>%
  correlation::correlation(p_adjust = "none")

correlation_DS_I  <- correlation_DS_I [1:5,]
correlation_DS_I <- as.data.frame(cbind(correlation_DS_I$Parameter1,
                                      correlation_DS_I$Parameter2,
                                      round(correlation_DS_I$r,3),
                                      round(correlation_DS_I$CI_low,3),
                                      round(correlation_DS_I$CI_high,3),
                                      round(correlation_DS_I$p,3)))

names(correlation_DS_I) <- names_corr

#trait anxiety - importance
df_TA_I <- df_means_scaled %>% select(c(mean_trait_anxiety, #create specific df for analysis
                                      mean_asp_overall_importance,
                                      mean_asp_sai,
                                      mean_asp_afi,
                                      mean_asp_fsi,
                                      mean_asp_cfi))

m1 <- lm(mean_trait_anxiety ~.,data = df_TA_I) #compute model

results_TA_I <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_TA_I) <- names_regr #rename dataframe with extracted results
results_TA_I$DV <- rep("TA",nrow(results_TA_I))

#get correlations
correlation_TA_I <- df_TA_I %>%
  correlation::correlation(p_adjust = "none")

correlation_TA_I  <- correlation_TA_I [1:5,]
correlation_TA_I <- as.data.frame(cbind(correlation_TA_I$Parameter1,
                                      correlation_TA_I$Parameter2,
                                      round(correlation_TA_I$r,3),
                                      round(correlation_TA_I$CI_low,3),
                                      round(correlation_TA_I$CI_high,3),
                                      round(correlation_TA_I$p,3)))

names(correlation_TA_I) <- names_corr
```

#### get results in dataframes, to preocess later in forestplot (importance)
```{r}
#regression results
results_regr_asp_importance <- rbind(results_SA_I,
                                     results_VI_I,
                                     results_CO_I,
                                     results_DS_I,
                                     results_TA_I)

#correlation results
results_corr_asp_importance <-rbind(correlation_SA_I,
                                    correlation_VI_I,
                                    correlation_CO_I,
                                    correlation_DS_I,
                                    correlation_TA_I)


#remove dataframes which aren't needed anymore
rm(list=c("results_SA_I", "results_VI_I", "results_CO_I", "results_DS_I", "results_TA_I","df_SA_I","df_VI_I","df_CO_I","df_DS_I","df_TA_I",
          "correlation_SA_I","correlation_VI_I","correlation_CO_I","correlation_DS_I","correlation_TA_I"))
```

### regressions and correlations (DV by aspiration chances)
```{r}
#self-actualization - chances
df_SA_C <- df_means_scaled %>% select(c(mean_self_actualization, #create specific df for analysis
                                      mean_asp_overall_chances,
                                      mean_asp_sac,
                                      mean_asp_afc,
                                      mean_asp_fsc,
                                      mean_asp_cfc))

m1 <- lm(mean_self_actualization ~.,data = df_SA_C) #compute model

results_SA_C <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_SA_C) <- names_regr #rename dataframe with extracted results
results_SA_C$DV <- rep("SA",nrow(results_SA_C))

#get correlations

correlation_SA_C <- df_SA_C %>%
  correlation::correlation(p_adjust = "none")

correlation_SA_C  <- correlation_SA_C [1:5,]
correlation_SA_C <- as.data.frame(cbind(correlation_SA_C$Parameter1,
                                      correlation_SA_C$Parameter2,
                                      round(correlation_SA_C$r,3),
                                      round(correlation_SA_C$CI_low,3),
                                      round(correlation_SA_C$CI_high,3),
                                      round(correlation_SA_C$p,3)))

names(correlation_SA_C) <- names_corr


#vitality - chances
df_VI_C <- df_means_scaled %>% select(c(mean_vitality, #create specific df for analysis
                                      mean_asp_overall_chances,
                                      mean_asp_sac,
                                      mean_asp_afc,
                                      mean_asp_fsc,
                                      mean_asp_cfc))

m1 <- lm(mean_vitality ~.,data = df_VI_C) #compute model

results_VI_C <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_VI_C) <- names_regr #rename dataframe with extracted results
results_VI_C$DV <- rep("VI",nrow(results_VI_C))

#get correlations

correlation_VI_C <- df_VI_C %>%
  correlation::correlation(p_adjust = "none")

correlation_VI_C  <- correlation_VI_C [1:5,]
correlation_VI_C <- as.data.frame(cbind(correlation_VI_C$Parameter1,
                                      correlation_VI_C$Parameter2,
                                      round(correlation_VI_C$r,3),
                                      round(correlation_VI_C$CI_low,3),
                                      round(correlation_VI_C$CI_high,3),
                                      round(correlation_VI_C$p,3)))

names(correlation_VI_C) <- names_corr

#control orientation - chances
df_CO_C <- df_means_scaled %>% select(c(mean_control_orientation, #create specific df for analysis
                                      mean_asp_overall_chances,
                                      mean_asp_sac,
                                      mean_asp_afc,
                                      mean_asp_fsc,
                                      mean_asp_cfc))

m1 <- lm(mean_control_orientation ~.,data = df_CO_C) #compute model

results_CO_C <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_CO_C) <- names_regr #rename dataframe with extracted results
results_CO_C$DV <- rep("CO",nrow(results_CO_C))

#get correlations
correlation_CO_C <- df_CO_C %>%
  correlation::correlation(p_adjust = "none")

correlation_CO_C  <- correlation_CO_C [1:5,]
correlation_CO_C <- as.data.frame(cbind(correlation_CO_C$Parameter1,
                                      correlation_CO_C$Parameter2,
                                      round(correlation_CO_C$r,3),
                                      round(correlation_CO_C$CI_low,3),
                                      round(correlation_CO_C$CI_high,3),
                                      round(correlation_CO_C$p,3)))

names(correlation_CO_C) <- names_corr

#depressive symptoms - chances
df_DS_C <- df_means_scaled %>% select(c(mean_depressive_symptoms, #create specific df for analysis
                                      mean_asp_overall_chances,
                                      mean_asp_sac,
                                      mean_asp_afc,
                                      mean_asp_fsc,
                                      mean_asp_cfc))

m1 <- lm(mean_depressive_symptoms ~.,data = df_DS_C) #compute model

results_DS_C <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_DS_C) <- names_regr #rename dataframe with extracted results
results_DS_C$DV <- rep("DS",nrow(results_DS_C))

#get correlations
correlation_DS_C <- df_DS_C %>%
  correlation::correlation(p_adjust = "none")

correlation_DS_C  <- correlation_DS_C [1:5,]
correlation_DS_C <- as.data.frame(cbind(correlation_DS_C$Parameter1,
                                      correlation_DS_C$Parameter2,
                                      round(correlation_DS_C$r,3),
                                      round(correlation_DS_C$CI_low,3),
                                      round(correlation_DS_C$CI_high,3),
                                      round(correlation_DS_C$p,3)))

names(correlation_DS_C) <- names_corr

#trait anxiety - chances
df_TA_C <- df_means_scaled %>% select(c(mean_trait_anxiety, #create specific df for analysis
                                      mean_asp_overall_chances,
                                      mean_asp_sac,
                                      mean_asp_afc,
                                      mean_asp_fsc,
                                      mean_asp_cfc))

m1 <- lm(mean_trait_anxiety ~.,data = df_TA_C) #compute model

results_TA_C <- extractModelStatistics(m1) #use above defined function to extract model information
names(results_TA_C) <- names_regr #rename dataframe with extracted results
results_TA_C$DV <- rep("TA",nrow(results_TA_C))

#get correlations
correlation_TA_C <- df_TA_C %>%
  correlation::correlation(p_adjust = "none")

correlation_TA_C  <- correlation_TA_C [1:5,]
correlation_TA_C <- as.data.frame(cbind(correlation_TA_C$Parameter1,
                                      correlation_TA_C$Parameter2,
                                      round(correlation_TA_C$r,3),
                                      round(correlation_TA_C$CI_low,3),
                                      round(correlation_TA_C$CI_high,3),
                                      round(correlation_TA_C$p,3)))

names(correlation_TA_C) <- names_corr
```

#### get results in dataframes, to preocess later in forestplot (chances)
```{r}
#regression results
results_regr_asp_chances <- rbind(results_SA_C,
                                     results_VI_C,
                                     results_CO_C,
                                     results_DS_C,
                                     results_TA_C)

#correlation results
results_corr_asp_chances <-rbind(correlation_SA_C,
                                    correlation_VI_C,
                                    correlation_CO_C,
                                    correlation_DS_C,
                                    correlation_TA_C)


#remove dataframes which aren't needed anymore
rm(list=c("results_SA_C", "results_VI_C", "results_CO_C", "results_DS_C", "results_TA_C","df_SA_C","df_VI_C","df_CO_C","df_DS_C","df_TA_C",
          "correlation_SA_C","correlation_VI_C","correlation_CO_C",
          "correlation_DS_C","correlation_TA_C"))
```

#### combine dataframes with effects and plot
```{r}
#combine regression results
results_regr_asp_importance$dimension <- rep("importance",nrow(results_regr_asp_importance))
results_regr_asp_chances$dimension <- rep("chances",nrow(results_regr_asp_chances))

#contains all regression results from above
results_regr_aspiration <- rbind(results_regr_asp_importance, results_regr_asp_chances)

#makes rownames in usable column
results_regr_aspiration$labels <- rownames(results_regr_aspiration)

#plotting
reg_asp_plot_data <- results_regr_aspiration

reg_asp_plot_data$combined_label <- with(reg_asp_plot_data, paste(DV, labels, sep = ": "))

# To preserve the original order, convert combined_label directly to a factor
# without changing the levels based on unique values or any sorting
reg_asp_plot_data$combined_label <- factor(reg_asp_plot_data$combined_label, levels = reg_asp_plot_data$combined_label)

# Now, plot using ggplot2 without reordering
ggplot(reg_asp_plot_data, aes(x = beta, y = combined_label, color = dimension)) +
  geom_point() +  # Add points for beta values
  geom_errorbarh(aes(xmin = ci_low, xmax = ci_high), height = 0.2) +  # Add horizontal error bars for CIs
  facet_wrap(~dimension, scales = "free_y", ncol = 1, strip.position = "left") +  # Group by 'dimension'
  theme_minimal() +  # Use a minimal theme for aesthetics
  labs(x = "Effect Size (Beta)", y = "") +  # Label the x-axis, remove y-axis label
  theme(legend.position = "none",  # Remove legend
        panel.spacing = unit(1, "lines"),  # Adjust spacing between panels
        axis.text.y = element_text(size = rel(0.8)),  # Adjust y-axis text size if needed
        strip.background = element_blank(),  # Optional: remove facet label background
        strip.text.y = element_text(size = rel(1.2)))  # Adjust facet label text size

#combine correlation results
results_corr_asp_importance$dimension <- rep("importance",nrow(results_corr_asp_importance))
results_corr_asp_chances$dimension <- rep("chances",nrow(results_corr_asp_chances))

#contains all correlation results from above
results_corr_aspiration <- rbind(results_corr_asp_importance, results_corr_asp_chances)

#we have usable row names already here

corr_asp_plot_data <- results_corr_aspiration

corr_asp_plot_data$r <- as.numeric(corr_asp_plot_data$r)
corr_asp_plot_data$ci_low <- as.numeric(corr_asp_plot_data$ci_low)
corr_asp_plot_data$ci_high <- as.numeric(corr_asp_plot_data$ci_high)

# Create a combined label for plotting
corr_asp_plot_data$combined_label <- with(corr_asp_plot_data, paste(DV, IV, sep = ": "))

# Convert the combined_label to a factor to maintain the original order
corr_asp_plot_data$combined_label <- factor(corr_asp_plot_data$combined_label, 
                                            levels = unique(corr_asp_plot_data$combined_label))

# Create the forest plot with correct confidence intervals
ggplot(corr_asp_plot_data, aes(x = r, y = combined_label, color = dimension)) +
  geom_point() +  # Plot the correlation coefficients as points
  geom_errorbarh(aes(xmin = ci_low, xmax = ci_high), height = 0.2) +  # Draw horizontal error bars for CIs
  facet_wrap(~dimension, scales = "free_y", ncol = 1) +  # Group by 'dimension'
  theme_minimal() +  # Use a minimal theme for a clean look
  labs(x = "Correlation Coefficient (r)", y = "") +  # Label the x-axis
  theme(axis.text.y = element_text(size = rel(0.8)),  # Adjust y-axis text size
        legend.position = "none",  # Remove the legend
        strip.background = element_blank(),  # Remove facet label background for a cleaner look
        strip.text.y = element_text(size = rel(1.2)))  # Adjust facet label text size for readability

#remove dataframes which aren't needed anymore
rm(list=c("results_regr_asp_importance",
          "results_regr_asp_chances", 
          "results_corr_asp_importance", 
          "results_corr_asp_chances"))

#these show the distribution of effects by frequency
hist(results_regr_aspiration$beta)
hist(as.numeric(results_corr_aspiration$r))
```

### group comparisons (assessment of relative centrality)
```{r}
#scale all aspiration index means
df_centr_asp <- df %>%
  mutate(across(starts_with("mean_asp"), 
                ~scale(.) %>% as.vector, 
                .names = "{.col}_z"))

#create binary variables by comparing z-score by person
#1 = higher z-score for financial success
df_centr_asp <- df_centr_asp %>% mutate(comp_fsi_afi = if_else(mean_asp_fsi_z > mean_asp_afi_z, 1, 0))
df_centr_asp <- df_centr_asp %>% mutate(comp_fsi_sai = if_else(mean_asp_fsi_z > mean_asp_sai_z, 1, 0))
df_centr_asp <- df_centr_asp %>% mutate(comp_fsi_cfi = if_else(mean_asp_fsi_z > mean_asp_cfi_z, 1, 0))

df_centr_asp <- df_centr_asp %>% mutate(comp_fsc_afc = if_else(mean_asp_fsc_z > mean_asp_afc_z, 1, 0))
df_centr_asp <- df_centr_asp %>% mutate(comp_fsc_sac = if_else(mean_asp_fsc_z > mean_asp_sac_z, 1, 0))
df_centr_asp <- df_centr_asp %>% mutate(comp_fsc_cfc = if_else(mean_asp_fsc_z > mean_asp_cfc_z, 1, 0))


#t-tests
##self-actualization - importance
test_1 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_fsi_afi, data = df_centr_asp)))
test_2 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_fsi_sai, data = df_centr_asp)))
test_3 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_fsi_cfi, data = df_centr_asp)))

##self-actualization - chances
test_4 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_fsc_afc, data = df_centr_asp)))
test_5 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_fsc_sac, data = df_centr_asp)))
test_6 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_fsc_cfc, data = df_centr_asp)))

##vitality - importance
test_7 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_fsi_afi, data = df_centr_asp)))
test_8 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_fsi_sai, data = df_centr_asp)))
test_9 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_fsi_cfi, data = df_centr_asp)))

##vitality - chances
test_10 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_fsc_afc, data = df_centr_asp)))
test_11 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_fsc_sac, data = df_centr_asp)))
test_12 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_fsc_cfc, data = df_centr_asp)))

##control-orientation - importance
test_13 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_fsi_afi, data = df_centr_asp)))
test_14 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_fsi_sai, data = df_centr_asp)))
test_15 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_fsi_cfi, data = df_centr_asp)))

##control-orientation - chances
test_16 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_fsc_afc, data = df_centr_asp)))
test_17 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_fsc_sac, data = df_centr_asp)))
test_18 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_fsc_cfc, data = df_centr_asp)))

##depressive symptoms - importance
test_19 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_fsi_afi, data = df_centr_asp)))
test_20 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_fsi_sai, data = df_centr_asp)))
test_21 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_fsi_cfi, data = df_centr_asp)))

##depressive symptoms - chances
test_22 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_fsc_afc, data = df_centr_asp)))
test_23 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_fsc_sac, data = df_centr_asp)))
test_24 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_fsc_cfc, data = df_centr_asp)))

##trait anxiety - importance
test_25 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_fsi_afi, data = df_centr_asp)))
test_26 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_fsi_sai, data = df_centr_asp)))
test_27 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_fsi_cfi, data = df_centr_asp)))

##trait anxiety - chances
test_28 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_fsc_afc, data = df_centr_asp)))
test_29 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_fsc_sac, data = df_centr_asp)))
test_30 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_fsc_cfc, data = df_centr_asp)))

#combine results from all tests
results_t_test_aspiration <- do.call(rbind, list(test_1, test_2, test_3, test_4, test_5, test_6, test_7, test_8, test_9, test_10, 
                                                 test_11, test_12, test_13, test_14, test_15, test_16, test_17, test_18, test_19, test_20, 
                                                 test_21, test_22, test_23, test_24, test_25, test_26, test_27, test_28, test_29, test_30))
results_t_test_aspiration <- as.data.frame(results_t_test_aspiration)

# Remove the individual dataframes from environment
test_vars <- paste0("test_", 1:30)
rm(list = test_vars)

#plot effects
# Combine Parameter and Group into a new column for labeling
results_t_test_aspiration$Label <- paste(results_t_test_aspiration$Parameter, "-", results_t_test_aspiration$Group)

# Adjusting the plot to use the new Label column for y-axis labels
ggplot(results_t_test_aspiration, aes(x = Difference, y = Label)) +
  geom_point() +  # Add the mean difference as points
  geom_errorbarh(aes(xmin = CI_low, xmax = CI_high), height = 0.2) +  # Add CI as horizontal error bars
  labs(y = "Comparison", x = "Mean Difference") +  # Label the axes
  theme_minimal() +  # Use a minimal theme
  theme(axis.text.y = element_text(size = 7),  # Adjust text size for clarity if needed
        axis.title.y = element_blank())  # Remove the y-axis title for a cleaner look


hist(results_t_test_aspiration$d)

results_t_test_aspiration_05 <- subset(results_t_test_aspiration, p < .05)
```

### guiding principles correlations
```{r}
names_corr <- c("DV", "IV", "r", "ci_low", "ci_high", "p")

###correlations of mean rank-order of guiding principles with outcomes

#self-actualization - importance
df_SA_gpr <- df_means_scaled %>% select(c(mean_self_actualization, #create specific df for analysis
                                      mean_gpr_money,
                                      mean_gpr_family_security,
                                      mean_gpr_global_welfare))

#get correlations

correlation_SA_gpr <- df_SA_gpr %>%
  correlation::correlation(p_adjust = "none")

correlation_SA_gpr  <- correlation_SA_gpr [1:3,]
correlation_SA_gpr <- as.data.frame(cbind(correlation_SA_gpr$Parameter1,
                                      correlation_SA_gpr$Parameter2,
                                      round(correlation_SA_gpr$r,3),
                                      round(correlation_SA_gpr$CI_low,3),
                                      round(correlation_SA_gpr$CI_high,3),
                                      round(correlation_SA_gpr$p,3)))

names(correlation_SA_gpr) <- names_corr


#vitality - importance
df_VI_gpr <- df_means_scaled %>% select(c(mean_vitality, #create specific df for analysis
                                      mean_gpr_money,
                                      mean_gpr_family_security,
                                      mean_gpr_global_welfare))

#get correlations

correlation_VI_gpr <- df_VI_gpr %>%
  correlation::correlation(p_adjust = "none")

correlation_VI_gpr  <- correlation_VI_gpr [1:3,]
correlation_VI_gpr <- as.data.frame(cbind(correlation_VI_gpr$Parameter1,
                                      correlation_VI_gpr$Parameter2,
                                      round(correlation_VI_gpr$r,3),
                                      round(correlation_VI_gpr$CI_low,3),
                                      round(correlation_VI_gpr$CI_high,3),
                                      round(correlation_VI_gpr$p,3)))

names(correlation_VI_gpr) <- names_corr

#control orientation - importance
df_CO_gpr <- df_means_scaled %>% select(c(mean_control_orientation, #create specific df for analysis
                                      mean_gpr_money,
                                      mean_gpr_family_security,
                                      mean_gpr_global_welfare))


#get correlations
correlation_CO_gpr <- df_CO_gpr %>%
  correlation::correlation(p_adjust = "none")

correlation_CO_gpr  <- correlation_CO_gpr [1:3,]
correlation_CO_gpr <- as.data.frame(cbind(correlation_CO_gpr$Parameter1,
                                      correlation_CO_gpr$Parameter2,
                                      round(correlation_CO_gpr$r,3),
                                      round(correlation_CO_gpr$CI_low,3),
                                      round(correlation_CO_gpr$CI_high,3),
                                      round(correlation_CO_gpr$p,3)))

names(correlation_CO_gpr) <- names_corr

#depressive symptoms - importance
df_DS_gpr <- df_means_scaled %>% select(c(mean_depressive_symptoms, #create specific df for analysis
                                      mean_gpr_money,
                                      mean_gpr_family_security,
                                      mean_gpr_global_welfare))

#get correlations
correlation_DS_gpr <- df_DS_gpr %>%
  correlation::correlation(p_adjust = "none")

correlation_DS_gpr  <- correlation_DS_gpr [1:3,]
correlation_DS_gpr <- as.data.frame(cbind(correlation_DS_gpr$Parameter1,
                                      correlation_DS_gpr$Parameter2,
                                      round(correlation_DS_gpr$r,3),
                                      round(correlation_DS_gpr$CI_low,3),
                                      round(correlation_DS_gpr$CI_high,3),
                                      round(correlation_DS_gpr$p,3)))

names(correlation_DS_gpr) <- names_corr

#trait anxiety - importance
df_TA_gpr <- df_means_scaled %>% select(c(mean_trait_anxiety, #create specific df for analysis
                                      mean_gpr_money,
                                      mean_gpr_family_security,
                                      mean_gpr_global_welfare))

#get correlations
correlation_TA_gpr <- df_TA_gpr %>%
  correlation::correlation(p_adjust = "none")

correlation_TA_gpr  <- correlation_TA_gpr [1:3,]
correlation_TA_gpr <- as.data.frame(cbind(correlation_TA_gpr$Parameter1,
                                      correlation_TA_gpr$Parameter2,
                                      round(correlation_TA_gpr$r,3),
                                      round(correlation_TA_gpr$CI_low,3),
                                      round(correlation_TA_gpr$CI_high,3),
                                      round(correlation_TA_gpr$p,3)))

names(correlation_TA_gpr) <- names_corr

```

#### combine correlative findings and plot

```{r}
#correlation results
results_corr_gpr <- rbind(correlation_SA_gpr,
                          correlation_VI_gpr,
                          correlation_CO_gpr,
                          correlation_DS_gpr,
                          correlation_TA_gpr)

#remove non-needed dataframes

rm(list = c("correlation_SA_gpr",
            "correlation_VI_gpr",
            "correlation_CO_gpr",
            "correlation_DS_gpr",
            "correlation_TA_gpr"))

#we have usable row names already here

corr_gpr_plot_data <- results_corr_gpr

corr_gpr_plot_data$r <- as.numeric(corr_gpr_plot_data$r)
corr_gpr_plot_data$ci_low <- as.numeric(corr_gpr_plot_data$ci_low)
corr_gpr_plot_data$ci_high <- as.numeric(corr_gpr_plot_data$ci_high)

# Create a combined label for plotting
corr_gpr_plot_data$combined_label <- with(corr_gpr_plot_data, paste(DV, IV, sep = ": "))

# Convert the combined_label to a factor to maintain the original order
corr_gpr_plot_data$combined_label <- factor(corr_gpr_plot_data$combined_label, 
                                            levels = unique(corr_gpr_plot_data$combined_label))

# Create the forest plot with correct confidence intervals
ggplot(corr_gpr_plot_data, aes(x = r, y = combined_label)) +
  geom_point() +  # Plot the correlation coefficients as points
  geom_errorbarh(aes(xmin = ci_low, xmax = ci_high), height = 0.2) +  # Draw horizontal error bars for CIs
  theme_minimal() +  # Use a minimal theme for a clean look
  labs(x = "Correlation Coefficient (r)", y = "") +  # Label the x-axis
  theme(axis.text.y = element_text(size = rel(0.8)),  # Adjust y-axis text size
        legend.position = "none",  # Remove the legend
        strip.background = element_blank(),  # Remove facet label background for a cleaner look
        strip.text.y = element_text(size = rel(1.2)))  # Adjust facet label text size for readability
```





### guiding principles comparisons
```{r}
#scale all guiding principles means
df_centr_gpr <- df %>%
  mutate(across(starts_with("mean_gpr"), 
                ~scale(.) %>% as.vector, 
                .names = "{.col}_z"))

#create binary variables by comparing z-score by person
#1 = higher z-score for financial success
df_centr_gpr <- df_centr_gpr %>% mutate(comp_money_family = if_else(mean_gpr_money_z > mean_gpr_family_security_z, 1, 0))
df_centr_gpr <- df_centr_gpr %>% mutate(comp_money_welfare = if_else(mean_gpr_money_z > mean_gpr_global_welfare_z, 1, 0))

#t-tests
##self-actualization
test_1 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_money_family,data = df_centr_gpr)))
test_2 <- as.data.frame(report::report(t.test(mean_self_actualization ~ comp_money_welfare,data = df_centr_gpr)))

##vitality
test_3 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_money_family,data = df_centr_gpr)))
test_4 <- as.data.frame(report::report(t.test(mean_vitality ~ comp_money_welfare,data = df_centr_gpr)))

##control orientation
test_5 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_money_family,data = df_centr_gpr)))
test_6 <- as.data.frame(report::report(t.test(mean_control_orientation ~ comp_money_welfare,data = df_centr_gpr)))

##depressive symptoms
test_7 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_money_family,data = df_centr_gpr)))
test_8 <- as.data.frame(report::report(t.test(mean_depressive_symptoms ~ comp_money_welfare,data = df_centr_gpr)))

##trait anxiety
test_9 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_money_family,data = df_centr_gpr)))
test_10 <- as.data.frame(report::report(t.test(mean_trait_anxiety ~ comp_money_welfare,data = df_centr_gpr)))

#combine results from all tests
results_t_test_gpr <- do.call(rbind, list(test_1, test_2, test_3, test_4, test_5, test_6, test_7, test_8, test_9, test_10))
results_t_test_gpr <- as.data.frame(results_t_test_gpr)

# Remove the individual dataframes from environment
test_vars <- paste0("test_", 1:10)
rm(list = test_vars)

#plot effects
# Combine Parameter and Group into a new column for labeling
results_t_test_gpr$Label <- paste(results_t_test_gpr$Parameter, "-", results_t_test_gpr$Group)

# Adjusting the plot to use the new Label column for y-axis labels
ggplot(results_t_test_gpr, aes(x = Difference, y = Label)) +
  geom_point() +  # Add the mean difference as points
  geom_errorbarh(aes(xmin = CI_low, xmax = CI_high), height = 0.2) +  # Add CI as horizontal error bars
  labs(y = "Comparison", x = "Mean Difference") +  # Label the axes
  theme_minimal() +  # Use a minimal theme
  theme(axis.text.y = element_text(size = 7),  # Adjust text size for clarity if needed
        axis.title.y = element_blank())  # Remove the y-axis title for a cleaner look


hist(results_t_test_gpr$d)
```
# Combine effects

```{r}
#combine correlational effects
results_corr_gpr$dimension <- rep(NA,nrow(results_corr_gpr))

results_corr <- rbind(results_corr_aspiration,results_corr_gpr)

results_corr <- results_corr %>% filter(!grepl("overall", IV)) #remove rows with correlations of overall scores (only needed for regression models)

#removing prefix 'mean_'
results_corr$DV <- sub("^mean_", "", results_corr$DV)
results_corr$IV <- sub("^mean_", "", results_corr$IV)


#imputing 'gpr' as dimension (next to chances and importance in the aspiration indices)
results_corr$dimension[is.na(results_corr$dimension)] <- "gpr"

#recomving prefix 'gpr_'
results_corr$IV <- sub("^gpr_", "", results_corr$IV)

#removing prefix 'asp_'
results_corr$IV <- sub("^asp_", "", results_corr$IV)

#make order more intuitive
test <- results_corr %>%
  mutate(dimension = factor(dimension, levels = c("importance", "chances", "gpr"))) %>%
  mutate(DV = factor(DV, levels = c("self_actualization", "vitality","control_orientation","depressive_symptoms","trait_anxiety"))) %>%
  arrange(DV, dimension)

# Now, 'dimension' is ordered as per the specified levels, and the dataframe is sorted accordingly.

corr_asp_plot_data <- test

corr_asp_plot_data$r <- as.numeric(corr_asp_plot_data$r)
corr_asp_plot_data$ci_low <- as.numeric(corr_asp_plot_data$ci_low)
corr_asp_plot_data$ci_high <- as.numeric(corr_asp_plot_data$ci_high)

# Create a combined label for plotting
corr_asp_plot_data$combined_label <- with(corr_asp_plot_data, paste(DV, IV, sep = ": "))

# Convert the combined_label to a factor to maintain the original order
corr_asp_plot_data$combined_label <- factor(corr_asp_plot_data$combined_label, 
                                            levels = unique(corr_asp_plot_data$combined_label))

corr_asp_plot_data$text_label <- with(corr_asp_plot_data, 
                                      paste0("", round(r, 2), 
                                             ", CI [", round(ci_low, 2), ", ", round(ci_high, 2), "]"))

# Create the forest plot with correct confidence intervals and add the text labels
ggplot(corr_asp_plot_data, aes(x = r, y = combined_label,color = dimension)) +
  geom_point() +  # Plot the correlation coefficients as points
  geom_errorbarh(aes(xmin = ci_low, xmax = ci_high), height = 0.2) +  # Draw horizontal error bars for CIs
  geom_text(aes(label = text_label, x = 1.05 * max(ci_high)), hjust = 0, size = 3, nudge_x = 0.02, colour = "black") +
  facet_wrap(~dimension, scales = "free_y", ncol = 1) +  # Group by 'dimension'
  theme_minimal() +  # Use a minimal theme for a clean look
  labs(x = "Correlation Coefficient (r)", y = "") +  # Label the x-axis
  theme_classic()+
  theme(axis.text.y = element_text(size = rel(0.8)),  # Adjust y-axis text size
        legend.position = "none",  # Remove the legend
        strip.background = element_blank(),  # Remove facet label background for a cleaner look
        strip.text.y = element_text(size = rel(1.2)))  # Adjust facet label text size for readability
```






