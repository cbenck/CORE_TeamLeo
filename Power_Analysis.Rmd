---
title: "Power Analysis"
author: "Dominik Meindl"
date: "2023-11-27"
output: html_document
---

# Packages
```{r}
<<<<<<< HEAD
#Packages----
=======
#Packages---- using R4.3.2
>>>>>>> 5d4051313b80a1de4f135399ef3fe5b6088057e5
library(pwr) #1.3-0
library(esc) #0.5.1
library(readr) #2.1.4
library(tidyverse) #2.0.0
```

#Load Data
This is raw data extracted from the publication. Such as Means, standard deviations, t values and significance (.05 or .10) as well as which study this data has been extracted from.

df = all values concerning t tests
- mx: mean of first variable
- my: mean of second variable (FSI/FSC)
- sdx: sd of first variable
- sdy: sd of second variable (FSI/FSC)
- t: t-value
- sig05: 1 if p <.05
- sig10: 1 if p <.10
- study: 1 for study 1, 2 for study 2
- n: sample size

df2 = all values concerning correlations
- beta: beta values
- correlation: Pearsons r
- sig05_beta: 1 if p <.05 (beta)
- sig05_cor: 1 if p <.05 (r)
- sig10_beta: 1 if p <.10 (beta)
- sig10_cor: 1 if p <.10 (r)
- study: 1 for study 1, 2 for study 2
- n: sample size

```{r}
#load data----
df <- read_csv2("./data/ttests_raw.csv")
df2 <- read_csv2("./data/correlations_raw.csv")
```

#Power Transformations - Cohens D Values of T-Tests
Calculate Cohens d for all t-tests using the esc package.
Afterwards we will add the variable descriptions as well as the Study ID to the dataframe. 
This is the same code as used in Power_Analysis.rmd.

Due to an error introduced by R 4.3.2 we had to change out approach, we now have to use a for loop to extract the data from the esc function.

```{r}
#cohens d calc. for t tests-----
for(i in 1:nrow(df)){
  x <-esc::esc_mean_sd( grp1n=df$n[i], grp1m=df$mx[i], grp1sd = df$sdx[i], 
                    grp2n = df$n[i], grp2m = df$my[i], grp2sd = df$sdy[i],
                    es.type="d")
  if(i == 1) {
    cohens_d <- x
  } else {
    cohens_d <- rbind(cohens_d, x) # Add new data to dataframe
  }
}
cohens_d <- as.data.frame(cohens_d)
```

This approach gives new variable names which arent identical to the previous ones so we change those.
We also drop two collumns as these only contain an empty collumn, and a collumn describing that we used SD and M per group for our D calculation.

```{r}
new_names <- c("es","se","var",	"ci.lo",	"ci.hi","weight",	"sample.size","measure")
names(cohens_d) <- new_names

cohens_d <- cohens_d%>%select(c(1:7)) #dropping last two collumns as these are irrelevant
```

We now add the beforementioned variable names and study id back into the dataframe and save it.
This version is now identical to the old one, with the sole exception of it not containing a collumn "method" which only contains the value "d".

```{r}
cohens_d$variable <- df$variable
cohens_d$study <- df$study
#write_csv2(cohens_d, "./data/cohens_d_ttests.csv")
```

#Power Transformations - Cohens D Values of correlations
```{r}
#cohens d calc. for correlations ----
cohens_d_r <- esc::cohens_d(df2$correlation) #as there is no SD given for the variables (check with LEO to see if im not misinterpreting something here)
cohens_d_r <- as.data.frame(cohens_d_r)

cohens_d_r$variable <- df2$variable
cohens_d_r$study <- df2$study

<<<<<<< HEAD
#write_csv2(cohens_d, "./data/cohens_d_ttests.csv") 
=======
#write_csv2(cohens_d, "./data/cohens_d_corr.csv") 
>>>>>>> 5d4051313b80a1de4f135399ef3fe5b6088057e5
```

## Power Tests for t-tests and correlations.
Power calculations for the study have been conducted by adjusting multiple criteria.

An effect size of 0.3 has been chosen as this was the smallest (as significant) reported effect. 
Alpha has been Bonffroni corrected, to be 0.0009090909 (0.05/55, 55 as the amount of seperate t tests conducted).
We also adjusted the power level to 0.99. #So argumentieren oder anders?

For the correlations we used r=.21 as the smallest effect size of interest. 

```{r}
#PWR Calc for n ----
pwr.t.test(d=0.3, sig.level = 0.0009090909, power=0.99, type="two.sample", )

pwr.r.test(r=0.21, power=0.99, alternative = "two.sided")
```

For the t-tests we found a sample size of n≈711 per group. Therefore we need a sample of n=1422 for the study to be sufficiently powered.

For the correlations we found a sample size needed of n≈407 participants per group. We therefore need a sample of n=814 for it to be suffiziently powered.

We decided for the sample size of n=1422 as this is those are the more important measures, going with 1422 also allows us to have both measures sufficiently powered for later analysis.
